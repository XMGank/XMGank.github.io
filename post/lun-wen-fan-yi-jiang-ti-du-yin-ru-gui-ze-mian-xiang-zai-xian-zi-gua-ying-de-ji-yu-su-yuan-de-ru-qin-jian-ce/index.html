<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>[论文翻译] 将梯度引入规则：面向在线、自适应的基于溯源的入侵检测 | PIPKIN</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://xmgank.github.io/favicon.ico?v=1764579352066">
<link rel="stylesheet" href="https://xmgank.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="
Incorporating Gradients to Rules: Towards Online, Adaptive Provenance-based Intrusion Detection

将梯度引入规则：面向在线、自适应的基于溯源的..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://xmgank.github.io">
        <img src="https://xmgank.github.io/images/avatar.png?v=1764579352066" class="site-logo">
        <h1 class="site-title">PIPKIN</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/XMGank" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      温故而知新
    </div>
    <div class="site-footer">
      Powered by <a href="mailto:xminck@163.com" target="_blank">PIPKIN</a> | <a class="rss" href="https://xmgank.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">[论文翻译] 将梯度引入规则：面向在线、自适应的基于溯源的入侵检测</h2>
            <div class="post-date">2025-12-01</div>
            
            <div class="post-content" v-pre>
              <!-- more -->
<p>Incorporating Gradients to Rules: Towards Online, Adaptive Provenance-based Intrusion Detection</p>
<blockquote>
<p>将梯度引入规则：面向在线、自适应的基于溯源的入侵检测</p>
</blockquote>
<h1 id="摘要">摘要</h1>
<p>随着网络攻击变得日益复杂和隐蔽，准确区分良性行为与恶意入侵变得既愈发关键又充满挑战。基于溯源的入侵检测系统（PIDS）通过细粒度的因果分析在检测恶意活动方面显示出巨大潜力，因此受到了工业界和学术界的广泛关注。在各种 PIDS 方法中，基于规则的系统因其低开销、实时检测能力以及可解释性而备受青睐。然而，由于缺乏经过微调的规则以及针对特定环境的适配，这些系统在降低误报率方面面临着挑战。在本文中，我们介绍了 CAPTAIN+，这是一种能够在线自主适应多样化环境的基于规则的 PIDS 。具体而言，我们提出了三个自适应参数，用于调整节点、边以及警报生成阈值的检测配置 。首先，我们构建了一个可微分的标签传播框架，并利用梯度下降算法基于训练数据优化这些自适应参数。在这个扩展版本中，我们在检测阶段集成了一个在线学习模块，根据检测过程中的实时反馈动态优化自适应参数。我们利用 DARPA TC、OpTC 数据集和 PKU ASAL 数据集对 CAPTAIN+ 进行了评估。结果表明，与最先进的 PIDS 相比，CAPTAIN+ 提供了卓越的检测精度、更低的检测延迟、更低的运行时开销、针对概念漂移的长期鲁棒性，以及更具可解释性的检测结果。</p>
<h1 id="i-介绍">I 介绍</h1>
<p>高级持续性威胁（APTs）对政府和工业界均构成重大风险 [1]。例如，2017 年 Equifax 数据泄露事件凸显了关键的隐私与安全漏洞 [2], [3]。此外，攻击者不断演进其战术以渗透系统并在较长时间内保持隐蔽。尽管基于溯源的入侵检测系统（PIDS）因其因果分析能力而备受关注，但在实际应用中仍面临关键挑战，包括警报疲劳、高昂的运行开销以及长检测延迟 [4], [5]。</p>
<p>警报疲劳 [6], [7] 是网络安全行业面临的一项严峻挑战。近期一项调查 [8] 显示，大型企业每天收到的警报数量可能超过 100,000 条，安全分析师平均每天需处理高达 5,000 条告警，这一工作量令人不堪重负，且其中绝大多数均为误报。海量的警报可能导致严重后果。例如，2013 年 Target 数据泄露事件所造成的损失，正是因为未能及时响应警报而进一步加剧。警报过载及其模糊性使得分析师难以迅速识别威胁 [9]。因此，大量的误报可能造成与单次漏报同样严重的危害。除了警报疲劳，网络安全系统还面临着运行时开销和检测延迟方面的挑战。高昂的计算开销限制了检测系统的大规模部署 [10]，而漫长的检测延迟则阻碍了及时的威胁响应，并降低了分析师的工作效率。 </p>
<p>在学术界，越来越多的 PIDS 采用嵌入技术（如 Word2Vec [11] 和 Graph2Vec [12]）对系统实体和事件进行编码。这些系统进一步利用神经网络，包括图神经网络（GNN）[13], [14] 和循环卷积神经网络（RCNN）[15]，来分析信息流并生成检测结果，这类系统被称为基于嵌入的 PIDS。尽管此类系统在检测性能方面取得了显著进展，但仍面临若干挑战：</p>
<p>C1. <strong>高计算开销</strong>：利用深度学习技术处理嵌入特征 [12], [15] 会导致巨大的计算开销。此外，缓存模型和嵌入向量显著增加了内存占用 [10]。</p>
<p>C2. <strong>长检测延迟</strong>：许多系统设计依赖时间窗口 [16] 或日志批处理 [11], [12]，从而引入了额外的检测延迟。</p>
<p>C3. <strong>结果缺乏可解释性</strong>：许多系统 [11], [17] 仅报告异常行为，缺乏攻击语义。模型的“黑盒”特性限制了对检测结果的理解，增加了警报处置的复杂性。</p>
<p>另一方面，有一类 PIDS [18]–[22] 基于人工定义的机制运行，用于生成系统实体的表示、传播信息流并触发警报，这类系统被称为<strong>基于规则的 PIDS</strong>。基于规则的 PIDS 利用简单的操作来生成语义丰富的警报，能够准确地定位可疑事件，并且所需的计算资源较低。此外，一些基于规则的方法支持实时数据处理，这降低了存储需求，并能以低延迟实现快速响应。在实践中，它们细粒度的检测能力和高效的性能尤为显著 。尽管具有这些优势，基于规则的 PIDS 在实际部署中仍面临若干挑战 ：</p>
<p><strong>C4. 固定规则</strong>：基于规则的 PIDS 通常依赖于简单且通用的规则（例如节点的置信度水平 [18]–[20] 或通用系统参数 [18]–[20], [22]）来区分良性和恶意图。然而，这些固定的规则很容易导致系统变得过于宽松或过于严格 。</p>
<p><strong>C5. 僵化的检测设置</strong>：现有方法未能考虑到不同检测环境之间的差异，因为它们的检测策略在不同数据集之间保持不变 。</p>
<p><strong>C6. 手动优化</strong>：即使可以进行某些调整，配置这些系统也需要大量的人力，严重依赖用户的专业知识以及对环境因素的手动分析 。</p>
<p><strong>C7. 对概念漂移的在线适应</strong>：系统主要行为的转变可能会降低检测模型和算法的性能 [8], [23]。因此，检测系统必须能够响应环境变化并动态调整其参数。然而，现有的基于规则的 PIDS 通常缺乏此类适应机制 。</p>
<p>为解决上述局限性，我们需要一种自动配置机制，使基于规则的 PIDS 能够根据检测反馈动态调整参数。本文提出的 CAPTAIN+ 是在我们前期会议论文 [24] 所介绍的 CAPTAIN 基础上的扩展版本；它改进了参数优化机制，使其能够支持基于误报反馈的在线调整。这一改进在进一步降低误报率的同时，增强了系统对概念漂移的适应能力，从而提升了其长期性能与可维护性。具体而言，CAPTAIN+ 的设计旨在保留传统基于规则 PIDS 优势的同时，自主获取最优配置。为此，我们引入了三个自适应参数，赋予系统更高的灵活性。为实现参数优化，我们构建了一个学习模块，并通过计算并记录各参数的梯度，将基于规则的系统转化为一个可微分函数 。这使得两阶段优化成为可能：</p>
<p>1) <strong>离线训练</strong>：利用损失函数，应用梯度下降算法基于训练数据对自适应参数进行优化。</p>
<p>2) <strong>在线适应</strong>：在检测阶段，学习模块一旦接收到误报或漏报的反馈，便即时计算损失。随后，系统立即更新参数以提升后续的检测效果 。如表 I 所概括，CAPTAIN+ 建立在 CAPTAIN 轻量级与自适应的基础之上，并通过引入在线学习机制以及从漏报（False Negatives）中学习的能力进行了增强。</p>
<p>表I：PIDS的比较</p>
<figure data-type="image" tabindex="1"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGY2MmZiODk2MzBiMWIyMmUyYzNmZDRjNGQxM2QyNWZfM3dzTElVWlVhNVl0QllZb0VYN2pvUFVmaEd1SlUyUGVfVG9rZW46S0pRemJQNTVDb2FLbVR4cnZVQ2NXQUx3bmZkXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>我们在多种良性及 APT 攻击场景下评估了 CAPTAIN+，使用了来自 DARPA TC 项目 [26]、OpTC 数据集 [27] 的广泛认可的公共数据集 [25]，以及与某安全运营中心（SOC）合作收集的模拟环境数据集 [28] 。评估结果表明，与传统的基于规则的 PIDS 相比，CAPTAIN+ 平均降低了超过 98%（60.18 ×）的误报率。此外，与最先进的基于嵌入的 PIDS 相比，CAPTAIN+ 在保持 CPU 使用率低于 15% 的同时，实现了显著更高的检测精度，以及大幅降低的内存消耗和延迟。与 CAPTAIN 相比，CAPTAIN+ 平均降低了超过 76%（4.2 倍改进）的误报，并且能够检测到更多的恶意事件。此外，CAPTAIN+ 有效地应对了概念漂移问题，并在检测过程中表现出更高的稳定性。最后，我们分析了选定的场景，以评估所学配置的可解释性。本文做出了以下贡献 ：</p>
<ul>
<li>
<p>我们开发了 CAPTAIN+，这是一种 PIDS，基于良性数据离线调整其标签传播规则，并利用在线学习模块结合良性和恶意反馈进行在线学习。这种设计赋予了 CAPTAIN+ 学习型系统的高精度和适应性，同时确保了长期的可维护性。</p>
</li>
<li>
<p>我们通过可微分的标签传播框架对 CAPTAIN+ 进行了参数化，实现了通过梯度下降在不同环境中进行参数微调，这保留了基于规则的系统所固有的轻量级、低延迟和细粒度检测能力。</p>
</li>
<li>
<p>我们实现了 CAPTAIN+，并在包括 DARPA TC、OpTC 数据集和 PKU ASAL 数据集在内的各种场景中对其进行了评估。结果表明，CAPTAIN+ 能够良好地适应不同环境，具有更高的检测精度、更低的延迟、更低的开销、更强的可维护性以及更具解释性的结果。为了促进未来的研究，我们在 <a href="https://www.google.com/search?q=https://anonymous.4open.science/r/CAPTAINplus-DA05">https://anonymous.4open.science/r/CAPTAINplus-DA05</a>（https://anonymous.4open.science/r/CAPTAINplus-DA05/README.md#enviroment-setup） 开源了我们的工作。</p>
</li>
</ul>
<h1 id="ii-背景和相关工作">II 背景和相关工作</h1>
<h2 id="a-provenance-based-intrusion-detection-基于溯源的入侵检测">A. Provenance-based Intrusion Detection 基于溯源的入侵检测</h2>
<p>近年来，基于溯源的入侵检测因其强大的关联与因果分析能力，受到了工业界和学术界的广泛关注。在溯源分析中，系统行为被表示为有向无环图，称为溯源图 [29], [30]。在这些图中，节点代表系统实体，例如进程、文件、套接字、管道和内存对象，而边则表示实体间的交互，包括文件访问和远程主机连接。根据实体信息、数据/控制流以及系统行为建模与聚合的方式，我们将 PIDS 分为两大类方法，即基于嵌入的方法和基于规则的方法。</p>
<p><strong>1）基于嵌入的 PIDS</strong>：基于嵌入的系统利用数值向量来表示、传播和聚合图中的系统实体、事件以及数据/控制流信息 [11], [13], [15], [16]。例如，PROVDETECTOR [31] 根据历史事件频率选取稀有路径，生成用于序列学习和异常检测的嵌入向量，但这需要处理整条路径以进行检测。UNICORN [23] 将从溯源图中提取的直方图进行嵌入，并对嵌入后的图草图进行聚类。尽管这些系统能实现较高的检测精度，但它们往往无法为其生成的警报提供上下文解释。例如，FLASH [11] 虽然能识别出具有因果关联的可疑实体，但这缺乏针对这些交互的详细攻击语义。因此，审查相应的审计日志并发起响应需要更多的人工投入 。</p>
<p>此外，由于这些技术通常要求结构化的输入，例如图或路径，基于嵌入的 PIDS 往往采用时间窗口或日志批处理的方式，从而引入了额外的检测延迟，本文将这一概念称为“缓冲时间” 。具体而言，缓冲时间是指在时间窗口内累积流式日志以构建图结构供后续处理所需的持续时长。先前的研究已实现了基于时间 [13] 或事件数量 [11] 的固定长度窗口，而另一些研究 [12] 则使用了可变长度窗口。在最坏的情况下，攻击发起后，PIDS 必须等待整个缓冲时间结束后才能开始检测过程。</p>
<p><strong>2）基于规则的 PIDS</strong>：基于规则的系统 [18]–[20], [22] 利用人工设计的规则将系统实体和事件映射为预定义的语义单元（例如标签 [18], [19]、TTP [20]），随后这些单元沿着信息流传播以生成检测结果。例如，POIROT [32] 将 APT 检测建模为图模式匹配问题，其中手工构建的查询图与溯源图进行对齐。此类系统因其实时处理能力和轻量级特性而备受欢迎。然而，由于缺乏细粒度规则和针对特定环境的配置，它们往往面临检测精度低的问题 。大多数基于规则的 PIDS [18]–[20] 采用简单、通用的规则，这导致它们缺乏灵活性，难以适应多样化的环境。这些系统通常依赖离散分类来表征系统实体的属性（例如私有或公共），并对所有节点和事件应用相同的规则。因此，它们缺乏准确区分相似图所需的粒度，往往导致规则要么过于宽松，要么过于严格，从而引发误报或漏报 。我们将在 §II-E 中进一步探讨这些挑战。</p>
<p>在本文中，我们采用基于规则的检测方法来构建 CAPTAIN+，主要基于以下原因：</p>
<p>1) 基于规则的检测具有计算高效性 [18], [23], [32]。</p>
<p>2) 基于规则的方法适用于实时检测，因其能够增量式地处理事件流 [30]。</p>
<p>3) 与基于嵌入的方法 [11], [14], [23] 相比，基于规则的方法 [18], [19], [21] 在检测过程及结果方面提供了更强的可解释性。</p>
<p>4) 基于规则的方法对模仿攻击具有鲁棒性 [33]。</p>
<p>CAPTAIN+ 通过系统性地解决阻碍其在现实世界应用的局限性，相较于传统的基于规则的 PIDS 取得了显著的进步。与依赖简单、僵化规则的系统不同，CAPTAIN+ 引入了一种新颖且在数学上完备的框架，用于对标签初始化、传播及阈值进行自动微调。该方法提供了更高的灵活性与精确度，从而能够更准确地检测并响应安全威胁。</p>
<h2 id="b-configuration-as-an-optimization-problem-配置即优化问题"><strong>B. Configuration as an Optimization Problem 配置即优化问题</strong></h2>
<p>为基于规则的 PIDS 寻找最优配置可以形式化为一个优化问题，其目标是在参数空间中确定最佳参数 $$\theta$$，以最小化或最大化目标函数 $$J(\theta)$$ 。解决该优化问题的一种常用方法是梯度下降 [34] 。它利用目标函数关于参数的梯度 $$\nabla_{\theta}J(\theta)$$，根据公式 $$\theta = \theta - l \cdot \nabla_{\theta}J(\theta)$$ 来更新 $$\theta$$，其中 $$l$$ 为学习率 。基于梯度下降算法已提出了许多变体，包括随机梯度下降 [35]、小批量梯度下降、Adagrad [36] 以及 Adam [37] 。我们将在 §V-A 中讨论更多算法及其对 CAPTAIN+ 的适用性 。</p>
<p>尽管优化问题及其基于梯度的解法在定量科学与工程中发挥着重要作用 [38]，但由于以下挑战，它们在基于规则的 PIDS 的先前工作中鲜有讨论。首先，现有研究并未明确定义基于规则的 PIDS 中的可调参数。其次，对于基于规则的 PIDS 而言，设计目标函数，以及计算、更新和保存梯度下降算法所需的梯度，均是非平凡的挑战。在本文中，我们提出了 CAPTAIN+ 以填补这两个已确定的空白。</p>
<h2 id="c-online-learning-在线学习">C. Online Learning  在线学习</h2>
<p>传统的自适应学习方法往往依赖于预定义的训练数据集，并使用特定的算法来离线训练模型。然而，概念漂移 [39] 给它们在实际应用中的长期有效性带来了挑战。在线学习通过基于按序到达的数据持续更新其预测，从而迭代地优化模型的预测能力。该方法已被有效用于适应多样化的检测环境和快速变化的攻击向量 [40], [41]，通过实时适应不断演变的环境来实现更高的检测精度 [42]。然而，在线学习的关键挑战在于为持续学习选择合适的训练数据。这一挑战源于检测阶段与训练阶段之间数据的变异性，这使得必须对参数自适应策略以及梯度下降优化中使用的梯度计算进行修改。在本文中，我们将在线学习集成到 CAPTAIN+ 中，并定制了参数更新机制以应对这一挑战。通过利用在线学习，CAPTAIN+ 能够动态调整受标签传播影响的节点的参数。这种方法不仅提高了检测精度并降低了误报，还增强了系统的可维护性。</p>
<h2 id="d-threat-model-and-assumptions-威胁模型与假设"><strong>D. Threat Model and Assumptions 威胁模型与假设</strong></h2>
<p>遵循先前的工作 [16], [18], [19]，我们假设操作系统内核和审计工具属于可信计算基（Trusted Computing Base），这意味着攻击者无法篡改系统审计数据 。我们将硬件篡改或其他在审计日志中未留痕迹的攻击排除在考虑范围之外 。此外，我们假设在每个检测环境中，均可获得反映无恶意行为的日常活动的审计日志以用于训练 。</p>
<h2 id="e-motivation-examples-动机示例"><strong>E. Motivation Examples 动机示例</strong></h2>
<p>本节提出了几个动机示例，以阐明传统的、粗粒度的基于规则的 PIDS 所面临的挑战，如图 1 所示。</p>
<figure data-type="image" tabindex="2"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=NjY5M2U4YWZiZmU0ZjM5ZDJiNjBkZmJjM2EyYjlhYjZfazJPcmc1UE45dlVsZHlaNENTQmtJSlpRQVA4SUIwQm1fVG9rZW46RjBaNGJCSlR1b2xPcWN4TTZpWWNQMWN4blFnXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 1: 来自真实世界数据集的动机示例</p>
<p><strong>1）“灰色”节点</strong>：最近的报告表明，攻击者正越来越多地利用通常用于合法目的的商业 FaaS 服务，将流量重定向到命令与控制（C2）服务器，如图 1 (a) 所示。在此类场景中，良性和恶意活动都可能涉及与相同的外部 FaaS IP 进行通信，这使得它们难以区分。现有的基于规则的 PIDS 在表征这些 IP 时，往往依赖于过于粗糙的分类。例如，SLEUTH [18] 仅将节点分为三个可信度级别（良性认证、良性和未知），这限制了其进行精确区分的能力。因此，这些粗粒度规则要么产生过多的误报，要么未能检测到实际威胁。需要一种更细粒度的方法来捕捉这些 IP 的“灰度”。为每个节点分配一个连续的可信度值（例如，0 到 1 之间的浮点数）将实现更细致和自适应的检测。</p>
<p><strong>2）依赖爆炸</strong>：当单个事件的影响传播到过多的系统实体时，就会发生依赖爆炸，从而导致高计算开销和误报。已有许多方法被提出以解决该问题 [43]–[45] 。一类解决方案需要对应用程序或操作系统进行广泛的仪表化，这引入了显著的开销并限制了实际部署，特别是在终端主机系统上。另一类常见于基于规则的 PIDS 中的解决方案，采用了诸如事件白名单 [18]、基于代价的剪枝以及 APT 生命周期中可疑事件的阶段性分类 [20] 等技术。例如，MORSE [19] 引入了衰减和消减机制，以随着时间的推移逐渐降低归因于系统实体的恶意性。</p>
<p>然而，这些机制对所有节点和边应用统一的衰减和消减因子，导致在过多的误报与漏报之间产生权衡，因为攻击者可以通过派生大量无关进程或与良性实体交互来逃避检测。理想情况下，如图 1 (b) 所示，依赖爆炸应当在左图所示的场景中得到遏制，而在右图所示的情况下则应保留恶意性。为实现更细粒度的控制，我们提出为每个事件分配一个定制化的传播率。这使得恶意性对于常见事件能够迅速消散，而对于异常事件则得以保留，从而提高了检测精度并降低了误报。</p>
<p><strong>3）定制化警报触发</strong>：在基于规则的 PIDS 中，警报基于预定义条件触发，这些条件不考虑上下文而统一应用于所有事件，这可能导致检测性能欠佳。如图 1 (c) 所示，进程 Firefox 和 sshd 均频繁地与各种 IP 地址进行网络活动。虽然 sshd 通常利用 bash 执行脚本，但对于 Firefox 而言，此类行为则是异常且潜在可疑的。尽管在事件类型和相关实体上存在相似性，但若对所有“执行”事件应用统一的规则阈值，可能会针对 sshd 产生误报，或者未能检测到涉及 Firefox 的真实威胁。为应对这一挑战，需要一种更具上下文感知能力的方法。对于常见事件，应设置较高的阈值以最小化误报；而对于罕见事件，则需设置较低的阈值以防止漏报真实警报 。然而，确定如何为不同进程的“执行 bash”事件设置不同的阈值仍然具有挑战性。</p>
<p><strong>4）概念漂移</strong>：模型运行的环境并非静态；系统行为的变化可能导致概念漂移，进而造成模型性能下降。如图 1 (d) 所示，当进程 <code>bash</code> 首次被引入时，其初始机密性和可靠性评分均被设定为默认值 1。随着时间的推移，随着更多事件被处理，标签传播导致 <code>bash</code> 的标签评分发生变化。具体而言，当 <code>bash</code> 多次对文件 <code>/dev/tty</code> 执行读取操作时，其标签评分显著下降。类似地，当 <code>bash</code> 写入文件 <code>/home/user/.bash_history-44482.tmp</code> 时，由于一个低可靠性的进程正在写入一个高可靠性的文件，警报被触发，这被识别为一次误报。</p>
<p>这些动机示例凸显了当前基于规则的 PIDS 在平衡检测覆盖率与误报率方面所面临的挑战，这主要归因于其粗粒度的规则。此外，这些系统往往难以适应环境变化，因其无法动态修改规则以适应不断演进的环境。另一方面，由深度学习驱动的基于嵌入的 PIDS 能够通过将图中的每个事件和实体映射到特征空间，为其生成定制化的“规则”。然而，深度神经网络的训练与部署需要大量的计算资源和存储空间，导致了显著的运行时开销。此外，这些系统的检测过程和结果通常缺乏透明度，使得在单个事件的粒度上识别恶意行为变得困难。</p>
<p>为应对这些挑战，我们的方法通过引入细粒度规则增强了基于规则的 PIDS，从而在检测精度与误报之间实现了更好的平衡。通过使这些系统能够基于训练数据自适应并优化规则，我们能够在显著提高检测精度的同时，避免通常与深度学习方法相关的高昂计算成本和运行时开销。此外，为了专门解决概念漂移问题并增强长期可维护性，我们在 CAPTAIN+ 的检测阶段引入了在线学习模块。这使得系统能够基于实时反馈进行动态调整，不仅通过适应不断演进的系统行为来减少误报，还降低了系统对静态训练数据集的依赖。</p>
<h1 id="iii-captain-的设计">III CAPTAIN+ 的设计</h1>
<p>如图 2 所示，CAPTAIN+ 由两个主要组件构成：检测模块和学习模块。检测模块负责处理审计日志以生成检测结果。与此同时，学习模块利用误报和漏报，在整个训练和检测阶段对检测模块进行微调。</p>
<figure data-type="image" tabindex="3"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmVlODY5MDI5NTM3ODVlYWE1ZTQ5YjRmZWY5YWM4MTZfb0xZblQ5VlpKb1doVVRFc0d1WDZjVlFkSVhqWHVkSUNfVG9rZW46U0pwamJleTA5b05LaHh4RHg5M2NGNzBrbjdjXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 2: CAPTAIN+ 架构</p>
<h2 id="a-adaptive-detection-module-自适应检测模块">A. Adaptive Detection Module <strong>自适应检测模块</strong></h2>
<p>如算法 1（第 2-4 行）和算法 2（第 1-4 行）所详述，CAPTAIN+ 中的检测模块按顺序执行三个阶段：标签初始化、标签传播和警报生成。该过程始于新系统实体的引入；每个实体均被分配一个包含其安全状态和上下文信息的初始标签。随后，随着系统事件的发生，这些标签在溯源图中传播，持续更新安全上下文。在最后阶段，警报生成组件根据预定义的安全策略对系统活动进行评估，以识别并标记恶意行为。</p>
<figure data-type="image" tabindex="4"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=MDBlY2VkOTdhNDRiM2NjZmQ0MWVmZWM4ODBiYmVjOWJfb2dlOFRJOFRPRzRYemN0Y2lKT1MyWjJoWG51WXBjMzVfVG9rZW46WGdPNWI1cFk1bzZjbWR4emQwemM5NDUwbkxlXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=NjQ1ZjQxNTdlMjdmZDc4ZWM3NzUxYjdiOWY3ZmY2MzJfeGVtNkQ1VVBaZEZ1RnhhcmhjS21GNnpWTkloTXNWYVdfVG9rZW46VGVDMWIxckpJb21jMVV4Z0lsb2NuNFBUbnNoXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p><strong>1）标签设计</strong>：受先前利用数据流和控制流的基于溯源方法的启发 [46]，CAPTAIN+ 采用了两种类型的标签：数据标签和代码标签，如表 II 详述。数据标签适用于溯源图内的所有节点，通过数值向量 &lt;c, i&gt; 来量化数据的恶意性，其中 c 代表机密性评分，i 代表数据的完整性评分。相反，由 &lt;p&gt; 表示的代码标签用于评估代码的完整性，且仅适用于进程节点。所有评分（c、i 和 p）的取值范围均为 0 到 1，其中较低的分数暗示潜在的受损风险，而较高的分数则表示可信度。</p>
<p>TABLE II: CAPTAIN+ 中的标签定义</p>
<figure data-type="image" tabindex="6"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=MmZmNTBkNjgxMmEzMDcyOThjOTc0MWQ1YzhlNGQ1MWVfQzZSclIzT09VdWY0Yk1IWVRnQTZQNGVtRnhkZmJvV09fVG9rZW46RkRsQWJrdFhlb0JyUGl4RklsZ2M3aUhrbnhoXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>CAPTAIN+ 的标签系统参考了先前的基于规则的 PIDS 方法 [18], [19]，尽管本文并未深入探讨标签设计的基本原理。我们规定，集成到 CAPTAIN+ 中的任何新标签类型均须满足三项准则：1) 具备数值表示，2) 可通过算术计算进行更新，3) 能够基于标签值触发警报。例如，可为 Web 服务节点开发“可利用性”标签，并为其配置特定的传播与警报规则。本文的重点在于展示 CAPTAIN+ 学习模块所带来的性能提升，而非标签设计的具体细节，从而为特定场景下的定制化标签开发预留了空间 。</p>
<p>CAPTAIN+ 的在线学习设计构建于三个自适应参数之上：1) 标签初始化值（A），用于确定系统实体的初始标签；2) 标签传播率（G），用于调节系统事件对标签值的影响程度；3) 警报生成阈值（T），用于修改警报生成规则。我们将详细阐述 CAPTAIN+ 如何利用这些参数来增强基于规则检测的灵活性。</p>
<p><strong>2）标签初始化</strong>：恰当的标签初始化规则至关重要，因为它们决定了系统实体的初始安全状态。例如，若将低完整性标签分配给连接至良性 IP 地址的套接字，可能会引发大量误报。然而，这一方面在现有文献 [18], [19] 中往往未被充分讨论，其中的初始标签通常仅基于领域知识进行分配，且缺乏后续调整。尽管 MORSE 指出标签初始化策略可参考先前的追踪数据，但其缺乏详细的讨论或切实的实现方法论。</p>
<p>在 CAPTAIN+ 中，标签初始化发生于节点首次被加入溯源图之时，如图 2 中的步骤 ① 所示 。检测系统扫描传入的系统审计日志以识别新实体，随后将其作为带有初始数据标签的节点进行添加。对于新建的进程节点，我们并不直接初始化其代码标签和数据标签。进程节点的代码标签值继承自其加载库的数据标签，而其数据标签值则继承自其父节点。对于非进程节点，我们在节点层级采用自适应参数 $$A$$，从而为溯源图中的任意节点 $$n_i \in N$$ 实现细粒度的标签初始化规则。参数 $$A$$ 基于节点的特定特征（诸如文件路径、进程名称及命令行）存储其初始数据标签。例如，具有相同 IP 地址的套接字将基于该特征被分配相同的初始数据标签。</p>
<figure data-type="image" tabindex="7"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjMyYjQzN2QxYTIxNDliNTEwZTA4OTBlZjZiNWVjMTdfY1VTTVloOWRFNnFBS3FYV2JlTXpFQktmWjlPY3NhTE9fVG9rZW46R25UZmJEOWlDb3QxSnB4cTdRSGM0Uks4bkxkXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 2: CAPTAIN+ 架构</p>
<p>自适应参数 $$A$$ 使得 CAPTAIN+ 能够在节点层级学习细粒度的标签初始化规则 。CAPTAIN+ 的学习模块通过训练过程对 $$A$$ 进行微调（详见 §III-B），该过程始于默认值 $$A_0$$ 。为避免在早期阶段遗漏威胁，我们在基于良性数据的训练期间对 $$A_0$$ 进行保守设置，并容忍由此产生的一定量的初始误报。不同于 MORSE 采用保守设置以捕获所有潜在威胁 [19]，CAPTAIN+ 仅在初始训练阶段应用此类设置。例如，我们将所有 IP 地址的初始完整性值设为 0，以确保不会遗漏任何通过网络通信入侵的攻击者。</p>
<p>基于溯源的检测面临的一个关键挑战在于确立系统实体的初始信任评分。若缺乏广泛的领域特定知识，仅凭数据推导这些评分往往不可靠。为解决这一问题，CAPTAIN+ 采用了一种原则性的两阶段方法来实现评分的初始化与自适应。首先，在系统部署阶段，管理员执行一次性的人工规则配置，为不同类别的实体（如可执行文件、网络套接字）设定基线机密性评分。这一步骤从一开始便将关键的领域知识注入系统之中。此后，系统将完全自动化运行。当运行时创建新实体时，CAPTAIN+ 会依据预配置规则即时为其分配初始评分。随后，这些评分将通过标签传播及持续的在线学习过程进行动态调整。在后一过程中，自适应参数 $$A$$ 将基于实时反馈进行微调，以提升未来的检测精度。</p>
<p><strong>3）标签传播</strong>：如图 2 中的步骤 ② 所示，一旦标签完成初始化，特定的系统事件便会触发这些标签沿着信息流进行传播，并相应地更改代码标签和数据标签。在 CAPTAIN+ 中，标签传播旨在通过标签值传递并累积潜在的恶意意图。例如，事件 <code>(Firefox, read, IP)</code> 会将 <code>Firefox</code> 的数据标签更新为 <code>Firefox</code> 与 <code>IP</code> 两者标签值中的较低者，从而确保信息流中携带的任何恶意意图得以保留。我们的传播规则（详见表 III）基于先前的工作 [18], [19] 。为了确保公平比较，我们采用了 MORSE 推荐的默认超参数值。这些参数在表 III 中定义，包括数据和代码标签（dtag, ptag）、静止标签值（$$T_{qb}$$, $$T_{qe}$$）、衰减率（$$d_b$$, $$d_e$$）以及消减因子（$$a_b$$, $$a_e$$）等关键术语。</p>
<figure data-type="image" tabindex="8"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=NjIxYmEyZWNhNmMwNzNhY2EzY2IzY2EzM2UxOWIzNDhfU1BXRW1oUXZNVHBCeGttbUFOdDhid2JjYVRjWTNnQldfVG9rZW46QjhnY2JQRmNQbzdaS3B4VXJUcGNkMWZJbmdmXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 2: CAPTAIN+ 架构</p>
<p>TABLE III: 标签传播策略</p>
<figure data-type="image" tabindex="9"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=YTcwODFkM2VkZjUzYTZkNWRkNmY4ZDczMTIxNjdjZGZfRU1BcURjQWF2QkF2T2tqa1BBSkg4ekNER01XcXJ4Z3NfVG9rZW46VzNlVWJoRDNob0NQRVF4NHNmbWNwQnA2bjNkXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>然而，这种机制可能导致依赖爆炸问题 [19]，从而产生过多的误报。例如，正如 §II-E 中所讨论的，事件 <code>(bash, write, /home/user/.bash_history)</code> 普遍出现在许多误报传播链中，这表明溯源图内的良性活动被广泛误判为恶意行为。为解决这一问题，我们引入了自适应参数 $$G$$ 以控制传播率。具体而言，对于由 <code>(src_node_feature, event_type, dest_node_feature)</code> 所刻画的任意边 $$e \in E$$，$$G$$ 存储其传播率参数 $$g_e \in [0, 1]$$。在标签传播过程中，宿节点的标签 $$tag_{dest}$$ 按公式 (1) 所示进行更新，其中 $$tag_{rule}$$ 通常等于 $$tag_{src}$$，代表由表 III 所列传播规则确定的标签值。若 $$g_e$$ 的值接近 0，标签值的变化微乎其微；而若其值接近 1，则会导致显著变化 。</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>a</mi><msubsup><mi>g</mi><mrow><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msubsup><mo>=</mo><msub><mi>g</mi><mi>e</mi></msub><mo>⋅</mo><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>r</mi><mi>u</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>−</mo><msub><mi>g</mi><mi>e</mi></msub><mo>)</mo><mo>⋅</mo><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mspace width="1em"/><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">tag_{dest}^{new} = g_e \cdot tag_{rule} + (1 - g_e) \cdot tag_{dest} \quad (1)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9613919999999999em;vertical-align:-0.247em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p>
<p>CAPTAIN+ 通过其在线训练过程持续优化 $$G$$，具体细节在 §III-B 中详述。初始阶段，我们将所有 $$g_e$$ 值保守地设定为 1，以确保在初始阶段标签传播不发生衰减。这种方式允许信息在整个溯源图中实现最大程度的传播。该策略确保我们在训练阶段能够保留更广泛的潜在可疑节点和路径集合。通过防止信号过早衰减，我们为模型提供了更丰富的学习数据，从而增强了其捕获复杂威胁模式的能力。对于随后的在线检测，这一初始设置使得系统能够对未知实体保持最高警惕，因为潜在的风险指标在传播过程中不会因初始参数过于保守而受到削弱。</p>
<p><strong>4）警报生成</strong>：如图 2 中的步骤 ③ 所示，一旦发生事件，系统便会根据预定义的警报生成规则评估其是否满足触发警报的条件。我们的警报生成策略详见表 IV，这些策略沿用了 MORSE [19] 的设计，其中 <code>incl_exec(p)</code> 表示 <code>p</code> 包含执行权限，而 <code>socket(o)</code> 则在 <code>o</code> 指代套接字时成立。总体而言，这些规则基于事件、主体与客体的关联标签以及一个既定的阈值，可以通过微调该阈值来管理警报频率。例如，如果一个数据完整性值低于 0.5 的进程写入一个正常文件，就会启动文件损坏警报。在训练期间，来自诸如 <code>(sshd, execve, bash)</code> 等事件的频繁误报可能表明需要针对此类情况提高阈值。</p>
<figure data-type="image" tabindex="10"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=NGUwMzJlMzhkMjBmYzc1NGJhMWNkNTJlOGNiNzcxMjlfc2J3eDRLSnFiUE5uRlg2bGd5UFpNR012YUlyTTV5dThfVG9rZW46SmN3bGJmNkdwb3ZSaDh4amxkVGM2cHpJblg1XzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 2: CAPTAIN+ 架构</p>
<p>TABLE IV: 警报生成策略</p>
<figure data-type="image" tabindex="11"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=NGYwYjgwYzM5NDllOWU2MzIyZjUxODgwNTFmMDI4NDZfYVpSclFOcnlNOHAzUUM3RmxUU2NCbzdlZnk0MDRnaFpfVG9rZW46TWdzbWI5OHJub1haV3p4OWpTemNXNmZCbmVlXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>我们引入了一个自适应参数 $$T$$，以实现对警报阈值的细粒度调整。具体而言，对于溯源图中的任意边 $$e \in E$$，$$T$$ 存储其警报阈值 $$thr_e \in [0, 1]$$ 。对于边 $$e$$，检测函数 $$f(e)$$ 定义如公式 (2) 所示，其中 $$tag$$ 为边 $$e$$ 上的相关节点标签。较低的阈值 $$thr_e$$ 倾向于抑制警报，而较高的阈值则倾向于促进警报生成，这使得 CAPTAIN+ 能够在边级别动态调整响应灵敏度。与 $$A$$ 和 $$G$$ 类似，$$T$$ 也是通过 §III-B 中讨论的训练过程进行优化的。此外，在检测的在线学习阶段，$$T$$ 会根据传入数据和事件结果进行实时调整。最初，我们将默认阈值 ($$T_0$$) 设置为中立状态，即为每条边 $$e$$ 分配 $$thr_i = 0.5$$，以既不普遍抑制也不促进警报触发。</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>=</mo><mi>t</mi><mi>a</mi><mi>g</mi><mo>−</mo><mi>t</mi><mi>h</mi><msub><mi>r</mi><mi>e</mi></msub><mo>⇒</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>malicious</mtext><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if </mtext><mi>f</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>&lt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>benign</mtext><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>otherwise</mtext></mstyle></mtd></mtr></mtable></mrow><mspace width="1em"/><mo>(</mo><mn>2</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">f(e) = tag - thr_e \Rightarrow \begin{cases} \text{malicious}, &amp; \text{if } f(e) &lt; 0 \\ \text{benign}, &amp; \text{otherwise} \end{cases} \quad (2)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">malicious</span></span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">benign</span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if </span></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">otherwise</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></p>
<p>值得注意的是，CAPTAIN+ 的方法论具有系统性，且独立于特定的规则或标签，这使其广泛适用于各种基于规则的 PIDS，特别是像 SLEUTH [18] 和 HOLMES [20] 这样的污点分析系统。</p>
<h2 id="b-configuration-learning-module-配置学习模块">B. Configuration Learning Module <strong>配置学习模块</strong></h2>
<p>随着三个自适应参数的定义，检测系统的自适应配置问题被转化为一个优化问题：即寻找参数 $$A$$、$$G$$ 和 $$T$$ 的最优值，以最小化给定的目标函数。本节将详细阐述我们如何定义目标函数、计算所需梯度以及搜索最优参数值。与先前的 CAPTAIN 设计相比，CAPTAIN+ 在离线训练的基础上结合了在线学习能力，从而进一步提升了检测精度和长期可维护性。在线学习机制的引入使得 CAPTAIN+ 能够持续分析并适应误报与漏报，从而显著提高了模型的可靠性。</p>
<p><strong>1）损失函数</strong>：优化的第一步是定义目标函数，在我们的学习任务中被称为损失函数 。学习模块的目标是通过调整参数以减少分类错误（包括误报和漏报），同时保持对真实恶意事件的敏感性。因此，该损失函数由两部分构成：针对这些错误的误差项（$$\sum_{e \in E} \mathcal{L}(e)$$）以及用于维持泛化能力的正则化项（$$R$$）。</p>
<p>如公式 (3) 所示，误差项旨在惩罚错误警报——既包括误报（false positives）也包括漏报（false negatives）。具体而言，对于事件 $$e$$，若其评分 $$f(e)$$ 的符号不正确，则会产生惩罚。对于被误分类为良性的恶意事件（即漏报），其评分 $$f(e)$$ 将为正值。公式 (3) 中的函数旨在对这种错误评分进行惩罚。重要的是，正确分类的事件被排除在损失计算之外，以避免可能降低灵敏度或增加误报的不必要更新。</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">L</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>=</mo><mo>(</mo><mn>1</mn><mo>+</mo><mi mathvariant="normal">∣</mi><mi>f</mi><mo>(</mo><mi>e</mi><mo>)</mo><mi mathvariant="normal">∣</mi><msup><mo>)</mo><mn>2</mn></msup><mo>−</mo><mn>1</mn><mspace width="1em"/><mo>(</mo><mn>3</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(e) = (1 + |f(e)|)^2 - 1 \quad (3)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mord">∣</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span></p>
<p>我们损失函数的第二个组成部分是正则化项。如前所述，CAPTAIN+ 的离线训练阶段主要依赖于良性数据，以学习检测环境内的正常行为。在机器学习领域，One-class classification（OCC）算法旨在解决训练期间仅有一类样本（通常为“正常”类）可用的场景 [47]。受该领域开创性工作 [48], [49] 的启发，我们在损失函数中引入了正则化项，以防止在缺乏恶意训练样本的情况下参数变得过于宽松。其核心思想是使自适应参数尽可能接近默认值 ($$A_0, G_0, T_0$$)。通过最小化自适应参数与默认值之间的 $$l_2$$ 距离，我们在训练期间保护了检测能力，如公式 (4) 所示，其中 $$\alpha$$、$$\gamma$$ 和 $$\tau$$ 为正则化系数。在评估部分，我们将讨论正则化系数的影响（§IV-D2）以及对其进行微调的方法（§IV-A3）。</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mi mathvariant="script">L</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>+</mo><munder><munder><mrow><mi>α</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>A</mi><mo>−</mo><msub><mi>A</mi><mn>0</mn></msub><mi mathvariant="normal">∣</mi><msub><mi mathvariant="normal">∣</mi><mn>2</mn></msub><mo>+</mo><mi>γ</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>G</mi><mo>−</mo><msub><mi>G</mi><mn>0</mn></msub><mi mathvariant="normal">∣</mi><msub><mi mathvariant="normal">∣</mi><mn>2</mn></msub><mo>+</mo><mi>τ</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>T</mi><mo>−</mo><msub><mi>T</mi><mn>0</mn></msub><mi mathvariant="normal">∣</mi><msub><mi mathvariant="normal">∣</mi><mn>2</mn></msub></mrow><mo stretchy="true">⎵</mo></munder><mtext>Offline Training</mtext></munder><mspace width="1em"/><mo>(</mo><mn>4</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">Loss = \sum_{e \in E} \mathcal{L}(e) + \underbrace{\alpha||A - A_0||_2 + \gamma||G - G_0||_2 + \tau ||T - T_0||_2}_{\text{Offline Training}} \quad (4)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3717110000000003em;vertical-align:-1.321706em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.4702159999999997em;vertical-align:-1.720216em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em;"><span style="top:-1.415892em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Offline Training</span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em;"><span class="svg-align" style="top:-2.102em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="mord">∣</span><span class="mord">∣</span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span><span class="mord">∣</span><span class="mord">∣</span><span class="mord mathdefault">G</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="mord">∣</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.898em;"><span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.720216em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mclose">)</span></span></span></span></span></p>
<p>与离线训练不同，在线学习不包含正则化。这一省略是刻意为之，因为检测阶段发现的错误需要立即且有效的更新。训练期间用于防止过拟合的正则化技术并不适用于在线学习，因为在线学习要求系统能够针对误报和漏报迅速做出响应，而不应人为地限制其适应能力。</p>
<p><strong>2）可微分检测框架</strong>：构建自适应的基于规则的 PIDS 的核心挑战在于计算其参数（$$\partial f / \partial a_n, \partial f / \partial g_e$$ 和 $$\partial f / \partial thr_e$$）的梯度，因为检测过程通常涉及一系列离散且不可微的基于规则的决策。据我们所知，本文是首个在基于标签的 PIDS 中对参数梯度进行形式化与计算的工作。我们的方法通过针对误分类计算这些梯度来实现这一目标，具体细节见算法 1（第 5-6 行）和算法 2（第 5-7 行）。根据链式法则，参数（如 $$a_n$$）的梯度由公式 (5) 给出，其他参数（如 $$g_e$$ 和 $$thr_e$$）的推导过程类似。</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>=</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="script">L</mi><mo>(</mo><mi>e</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>+</mo><munder><munder><mrow><mi>α</mi><mo>⋅</mo><mo>(</mo><msub><mi>a</mi><mi>n</mi></msub><mo>−</mo><msub><mi>a</mi><mn>0</mn></msub><mo>)</mo></mrow><mo stretchy="true">⎵</mo></munder><mtext>Offline Training</mtext></munder><mspace width="1em"/><mo>(</mo><mn>5</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\frac{\partial Loss}{\partial a_n} = \sum_{e \in E} \frac{\partial \mathcal{L}(e)}{\partial f} \cdot \frac{\partial f}{\partial a_n} + \underbrace{\alpha \cdot (a_n - a_0)}_{\text{Offline Training}} \quad (5)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">L</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.7487060000000003em;vertical-align:-1.321706em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.4702159999999997em;vertical-align:-1.720216em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em;"><span style="top:-1.415892em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Offline Training</span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em;"><span class="svg-align" style="top:-2.102em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.898em;"><span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.720216em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span></p>
<p>在 CAPTAIN+ 中，我们通过将检测过程建模为一个可微分函数，从而实现了基于梯度的优化。我们计算每个自适应参数相对于系统损失的梯度，这使得我们能够利用梯度下降算法来寻找最优参数。下文将以节点的初始标签值 $$A$$ 作为代表性参数，详细阐述这一梯度计算过程。我们方法的核心在于在溯源图中递归地应用链式法则。由于最终的检测结果是节点标签的函数，而节点标签本身又是先前标签的函数，因此我们可以从损失函数出发，向后追踪梯度至任意初始参数（如 $$A$$）。递归始于图的初始状态。节点 $$n'$$ 上的标签相对于节点 $$n$$ 的初始值 $$a_n$$ 的梯度定义如下 ：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>t</mi><mi>a</mi><msub><mi>g</mi><msup><mi>n</mi><mo mathvariant="normal">′</mo></msup></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if </mtext><msup><mi>n</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if </mtext><msup><mi>n</mi><mo mathvariant="normal">′</mo></msup><mi mathvariant="normal">≠</mi><mi>n</mi></mrow></mstyle></mtd></mtr></mtable></mrow><mspace width="1em"/><mo>(</mo><mn>6</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\frac{\partial tag_{n&#x27;}}{\partial a_{n}} = \begin{cases} 1, &amp; \text{if } n&#x27; = n \\ 0, &amp; \text{if } n&#x27; \neq n \end{cases} \quad (6)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32797999999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if </span></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">n</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if </span></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">6</span><span class="mclose">)</span></span></span></span></span></p>
<p>这表明，在初始状态下，节点的标签仅取决于其自身的初始值。</p>
<p>对于递归步骤，我们考虑表 III 中详述的传播策略。当事件发生时，更新后的标签值 $$tag_{rule}$$ 由源节点标签 ($$tag_{src}$$) 和宿节点标签 ($$tag_{dest}$$) 确定。通过将链式法则应用于这些策略，我们推导出了梯度的递归公式。我们将不同的更新规则整合为以下综合方程：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>t</mi><mi>a</mi><msub><mi>g</mi><msup><mi>n</mi><mo mathvariant="normal">′</mo></msup></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>(</mo><mn>1</mn><mo>−</mo><msub><mi>g</mi><mi>e</mi></msub><mo>)</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if </mtext><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>r</mi><mi>u</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>g</mi><mi>e</mi></msub><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>s</mi><mi>r</mi><mi>c</mi></mrow></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>+</mo><mo>(</mo><mn>1</mn><mo>−</mo><msub><mi>g</mi><mi>e</mi></msub><mo>)</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if </mtext><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>r</mi><mi>u</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>t</mi><mi>a</mi><msub><mi>g</mi><mrow><mi>s</mi><mi>r</mi><mi>c</mi></mrow></msub></mrow></mstyle></mtd></mtr></mtable></mrow><mspace width="1em"/><mo>(</mo><mn>7</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\frac{\partial tag_{n&#x27;}}{\partial a_n} = \begin{cases} (1 - g_e) \frac{\partial tag_{dest}}{\partial a_n}, &amp; \text{if } tag_{rule} = c \\ g_e \frac{\partial tag_{src}}{\partial a_n} + (1 - g_e) \frac{\partial tag_{dest}}{\partial a_n}, &amp; \text{if } tag_{rule} = tag_{src} \end{cases} \quad (7)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32797999999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7031em;"><span style="top:-3.7031em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322159999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2031em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7031em;"><span style="top:-3.7031em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if </span></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">c</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if </span></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2031em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">7</span><span class="mclose">)</span></span></span></span></span></p>
<p>在此，第一种情况适用于标签被重置为常数 $$c$$ 的情形，在该更新规则下，这阻断了梯度从任何前序节点的流动。第二种情况对应于标签从源节点传播至宿节点的策略。第三种情况处理的是宿节点标签实质上保持不变（或仅受其先前状态影响）的策略。</p>
<p><strong>3）在线学习率</strong>：离线训练阶段受益于多轮次训练中的海量事件，使得采用较小的固定学习率即可实现渐进且稳定的收敛。相比之下，在线阶段必须从稀疏且关键的反馈中高效学习，因此必须采用动态学习率。该策略详见算法 2（第 6 行），其针对误报（False Positives）和漏报（False Negatives）采取了不同的处理方式。</p>
<p>对于误报，学习率 $$l_{fp}$$ 被设计为随着观测到的错误增多而增大，这使得模型能够随着时间的推移更激进地修正系统性偏差。其计算公式如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>l</mi><mrow><mi>f</mi><mi>p</mi></mrow></msub><mo>=</mo><msub><mi>l</mi><mrow><mi>b</mi><mi>a</mi><mi>s</mi><mi>i</mi><mi>c</mi></mrow></msub><mo>⋅</mo><mfrac><mi>N</mi><mi>η</mi></mfrac><mspace width="1em"/><mo>(</mo><mn>8</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">l_{fp} = l_{basic} \cdot \frac{N}{\eta} \quad (8)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.2407700000000004em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">η</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">8</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中，$$l_{fp}$$ 为学习率，$$l_{basic}$$ 为初始学习率，$$N$$ 为误报事件的数量，$$\eta$$ 为更新间隔。项 $$\frac{N}{\eta}$$ 作为缩放因子，随着观测到的误报批次增多而提高学习率。</p>
<p>漏报代表严重的检测失效，需要更强有力的修正 。因此，漏报的学习率 $$l_{fn}$$ 被设定为一个较大的常数值，以确保任何遗漏的威胁都能触发显著的模型更新。此外，由于检测恶意事件是首要目标，单次漏报的出现暗示模型整体上可能过于宽松。为抵消这一倾向，每当发现漏报时，我们还会调整未来误报的学习率。该调整遵循以下公式：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>l</mi><mrow><mi>f</mi><mi>p</mi></mrow><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msubsup><mo>=</mo><msubsup><mi>l</mi><mrow><mi>f</mi><mi>p</mi></mrow><mrow><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msubsup><mo>⋅</mo><mi>D</mi><mspace width="1em"/><mo>(</mo><mn>9</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">l_{fp}^{new} = l_{fp}^{old} \cdot D \quad (9)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0975000000000001em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">p</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.282216em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.899108em;"><span style="top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">p</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">9</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 $$D$$ 表示每次检测到漏报时应用于 $$l_{fp}$$ 的乘法因子。</p>
<p><strong>4）训练与测试</strong>：在上一节中，我们建立了一个用于计算系统自适应参数梯度的可微分框架。现详述我们如何利用梯度下降算法在两个截然不同的阶段对这些参数进行优化：初始离线训练阶段以及实时运行期间的持续在线学习阶段。</p>
<p>离线训练阶段的目标是从静态数据集中学习一组经过优化的基线参数（$$A$$、$$G$$ 和 $$T$$）。我们摒弃了随机初始化，转而采用一种保守的默认配置作为起点。这确保了系统从训练过程伊始便能保持对潜在威胁的高度敏感性。训练过程按轮次（epoch）进行。在每一轮次中，系统对整个训练数据集执行一次前向传播，以此传播标签并累积梯度。为确保收敛的稳定性，我们采用批量更新策略：在整个轮次中聚合所有梯度，且仅在最后时刻对模型参数进行一次更新（如算法 1 第 7-12 行所示）。参数更新遵循标准的梯度下降规则 ：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>=</mo><msub><mi>p</mi><mrow><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msub><mo>−</mo><mi>l</mi><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>p</mi><mrow><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msub></mrow></mfrac><mspace width="1em"/><mo>(</mo><mn>10</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">p_{new} = p_{old} - l \cdot \frac{\partial Loss}{\partial p_{old}} \quad (10)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">L</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 $$p$$ 代表任意自适应参数（例如 $$a_n$$、$$g_e$$ 或 $$thr_e$$），$$l$$为学习率。该迭代过程持续重复，直至达到最大轮次或模型性能收敛。最终学习到的参数构成了用于系统初始部署的定制化配置。</p>
<p>在线学习阶段使 CAPTAIN+ 能够实时适应不断演变的威胁，这在几个关键方面与离线训练截然不同。首先，不同于基于轮次（epoch-based）的训练，在线更新是事件驱动且即时的。更新由误分类触发，无论是分析师识别出的误报（FP）还是随后发现的漏报（FN）（参见算法 2 第 8 行）。其次，参数更新是针对错误类型量身定制的。误报触发的更新旨在使系统对未来类似事件更为宽松，而漏报触发的更新则使系统更为严格，从而提高其敏感性。此外，误分类表明相关节点的标签值不可靠。因此，在更新模型参数后，我们也立即更新被误分类节点本身的标签值，以防止级联错误并提高后续相关检测的准确性。该机制的有效性在 §IV-F3 中得到了验证。这种双阶段方法确保 CAPTAIN+ 以一个鲁棒且训练有素的模型为起点，并通过对实时反馈的持续适应不断提升其检测能力。</p>
<h1 id="iv-评价">IV 评价</h1>
<p>整个系统涵盖了数据解析、标签初始化、标签传播、警报生成、在线学习以及训练/测试框架，总计由约 5,000 行 Python 代码实现。我们通过为每个标签维护两个字典来存储 $$A$$ 和 $$G$$ 的梯度，从而实现了可微分标签传播框架。对于 $$T$$，由于其梯度独立于节点标签，因此无需将其存储在节点内部。我们部署了 CAPTAIN+，并在配备 Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60 GHz 和 1.0 TB 内存的 Ubuntu 22.04.3 Linux 服务器上进行了所有实验。我们的评估旨在回答以下研究问题：</p>
<ul>
<li>
<p><strong>RQ1.</strong> CAPTAIN+ 的准确性如何？</p>
</li>
<li>
<p><strong>RQ2.</strong> CAPTAIN+ 的效率如何？</p>
</li>
<li>
<p><strong>RQ3.</strong> CAPTAIN+ 对对抗性攻击的鲁棒性如何？</p>
</li>
<li>
<p><strong>RQ4.</strong> CAPTAIN+ 的长期性能如何？</p>
</li>
<li>
<p><strong>RQ5.</strong> 各个模块如何影响 CAPTAIN+ 的性能 ？</p>
</li>
</ul>
<h2 id="a-experiment-settings-实验设置">A. Experiment Settings <strong>实验设置</strong></h2>
<p><strong>1）数据集</strong>：我们利用来自 DARPA 透明计算（Transparent Computing）项目的公共取证数据集，以及与专业安全运营中心（SOC）合作在模拟环境中生成的数据集来评估 CAPTAIN+。</p>
<ul>
<li>
<p><strong>DARPA TC 数据集 [26]</strong>。DARPA TC 项目运行于 2016 年至 2019 年间，并进行了多次红队评估。该项目搭建了包含各种背景良性活动的平台，生成了包含数百万个良性事件和数百个恶意事件的数据集。</p>
</li>
<li>
<p><strong>DARPA OpTC 数据集 [27]</strong>。DARPA OpTC 项目在一组主机上执行了为期三天的红队 APT 攻击模拟，生成的数据包含七天的良性活动以及额外三天的良性与恶意混合活动。</p>
</li>
<li>
<p><strong>PKU ASAL 数据集 [28]</strong>。PKU ASAL 数据集由三台主机组成：一台 Linux 服务器、一台 Windows 服务器和一台 Windows 10 主机，在其上执行了各种正常用户活动。该数据集还包含五种模拟的 APT 攻击场景，包括 APT29 和 Sidewinder。</p>
</li>
</ul>
<p><strong>2）基线检测器</strong>：我们将 CAPTAIN+ 与六个作为基线的 SOTA PIDS 进行对比评估，旨在从不同维度考察 CAPTAIN+ 的性能。FLASH、KAIROS 和 NODLINK 是最新的 SOTA 基于嵌入的 PIDS，它们已对其他一些基于嵌入的 PIDS [17], [20], [23] 进行了评估，并展示了最先进的性能。这些系统均为开源项目，这使我们能够利用其开源代码在不同数据集上对其进行测试 。我们选择 MORSE 是因其为 SOTA 基于规则的 PIDS，这使我们能够评估本文提出的可微分自适应框架所带来的改进。为确保比较的公平性与无偏性，我们在评估中沿用了 MORSE 的设置。根据文献 [11], [13] 以及我们与作者的沟通，受限于专有许可限制，SHADEWATCHER 和 PROGRAPHER 的检测系统并未完全开源。尽管 SHADEWATCHER 的数据预处理模块已开源，但我们未能找到其用于训练和测试的预处理输出文件。因此，对于这些系统，我们利用现有代码评估了其数据预处理的效率与延迟，并依据其论文中报告的检测结果来评估检测精度 。我们依据原文对 MORSE 进行了复现。所有用于评估基线的代码也将公开发布，以供未来研究使用。</p>
<p><strong>3）实验设置：初始状态与数据划分</strong>：遵循先前的工作 [19]，我们假设攻击源自外部网络或现有文件 。与 §III-A 中提及的保守策略一致，我们将它们在 $$A_0$$ 中的初始完整性评分设定为 0，这表示低完整性。为确保训练过程的纯净性，我们基于攻击发生的真实（ground truth）时间戳来划分数据集。首次攻击前的所有数据被用作训练集（仅包含良性事件），而剩余数据则用于测试。每个数据集划分的具体细节见表 V。</p>
<p>TABLE V: 训练和测试的数据集统计</p>
<figure data-type="image" tabindex="12"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=M2VlODAxM2JkNmMzNDBkNDhhYjA4OGJlYTUwNDBlM2VfMFc1d2ExUTV0Tm1vNjB2bFlabUpBTlBYZ2xsN1hia0RfVG9rZW46RGJKc2JvQmRLb2I1QW54WHVFOWNnRFFlbktjXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p><strong>交叉验证</strong>：为防止过拟合并不违反审计日志的时序特性，我们采用时间序列交叉验证（Time-series Cross-validation），而非标准的 k 折交叉验证。标准 k 折交叉验证中的随机打乱（Shuffling）会破坏时间因果性，可能导致模型利用未来事件来预测过去事件。我们的方法包括设定一个时间窗口（约为训练集长度的 2/3），并通过在时间轴上向前滑动该窗口来构建 $$k$$ 个独立的训练/验证划分。在本实验中，我们将 $$k$$ 设定为 3。该方法为模型在未见流式数据上的性能提供了鲁棒且无偏的估计。</p>
<p><strong>超参数选择</strong>：CAPTAIN+ 的性能依赖于若干超参数，尤其是三个正则化系数（$$\alpha, \gamma, \tau$$）。我们提出了一种双重策略来进行参数选择。当存在带标签的验证集时，我们利用网格搜索来确定最优的超参数组合。我们的优化目标是选择能够产生最少误报（False Positives），且与保守基线相比能够维持或提升真阳性率（True Positive Rate）的配置。例如，针对 E3-CADETS 数据集，该过程得出的最优设置为 $$\alpha = 0.1, \gamma = 0.1, \tau = 0.1$$，学习率为 0.01。</p>
<p>在实际应用中，往往难以获取用于 PIDS 的全面验证集。针对此类场景，我们提出了一种基于启发式的方法来估计这些系数。由于我们的训练始于保守状态，误报的作用在于“放宽”规则。正则化项对此进行抵消，防止模型变得过于宽松从而遗漏真实攻击。因此，系数的大小应取决于管理员针对每个实体所能容忍的误报数量 ($$N$$)。基于这一原则，我们提供了以下启发式公式，以便在训练前对系数进行估算：$$\alpha \approx 3N, \gamma \approx 3N, \tau \approx 12N$$。</p>
<p>此外，我们为该启发式方法提供了数学证明。根据公式 5，令 $$\frac{\partial Loss}{\partial a_n}, \frac{\partial Loss}{\partial g_e}$$ 和 $$\frac{\partial Loss}{\partial thr_e}$$ 为零，可得以下条件：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>α</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="script">L</mi><mo>(</mo><mi>e</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>⋅</mo><mo>(</mo><msub><mi>a</mi><mi>n</mi></msub><mo>−</mo><msub><mi>a</mi><mn>0</mn></msub><msup><mo>)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>γ</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="script">L</mi><mo>(</mo><mi>e</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>g</mi><mi>e</mi></msub></mrow></mfrac><mo>⋅</mo><mo>(</mo><msub><mi>g</mi><mi>e</mi></msub><mo>−</mo><msub><mi>g</mi><mn>0</mn></msub><msup><mo>)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>τ</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="script">L</mi><mo>(</mo><mi>e</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>t</mi><mi>h</mi><msub><mi>r</mi><mi>e</mi></msub></mrow></mfrac><mo>⋅</mo><mo>(</mo><mi>t</mi><mi>h</mi><msub><mi>r</mi><mi>e</mi></msub><mo>−</mo><mi>t</mi><mi>h</mi><msub><mi>r</mi><mn>0</mn></msub><msup><mo>)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mstyle></mtd></mtr></mtable><mspace width="1em"/><mo>(</mo><mn>11</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\begin{aligned}
\alpha &amp;= -\sum_{e \in E} \frac{\partial \mathcal{L}(e)}{\partial f} \cdot \frac{\partial f}{\partial a_n} \cdot (a_n - a_0)^{-1} \\
\gamma &amp;= -\sum_{e \in E} \frac{\partial \mathcal{L}(e)}{\partial f} \cdot \frac{\partial f}{\partial g_e} \cdot (g_e - g_0)^{-1} \\
\tau &amp;= -\sum_{e \in E} \frac{\partial \mathcal{L}(e)}{\partial f} \cdot \frac{\partial f}{\partial thr_e} \cdot (thr_e - thr_0)^{-1}
\end{aligned} \quad (11)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9.146118em;vertical-align:-4.323059em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.823059em;"><span style="top:-6.823058999999999em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span><span style="top:-3.7743529999999996em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-0.7256470000000004em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.323059em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.823059em;"><span style="top:-6.823058999999999em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.7743529999999996em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-0.7256470000000004em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.323059em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p>
<p>由于正则化系数 $$\alpha, \gamma$$ 和 $$\tau$$ 用于离线学习，损失函数为 $$L(e) = \max(0, (1 - f(e))^2 - 1)$$。对于满足 $$-1 &lt; f(e) &lt; 0$$ 的误分类事件，其导数为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>−</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="script">L</mi><mo>(</mo><mi>e</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow></mfrac><mo>=</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mn>2</mn><mo>(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>)</mo><mspace width="1em"/><mo>(</mo><mn>12</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">-\sum_{e \in E} \frac{\partial \mathcal{L}(e)}{\partial f} = \sum_{e \in E} 2(1 - f(e)) \quad (12)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.7487060000000003em;vertical-align:-1.321706em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3717110000000003em;vertical-align:-1.321706em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>α</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mn>2</mn><mo>(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>)</mo><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>⋅</mo><mo>(</mo><msub><mi>a</mi><mi>n</mi></msub><mo>−</mo><msub><mi>a</mi><mn>0</mn></msub><msup><mo>)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>≈</mo><mn>3</mn><mi>N</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>γ</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mn>2</mn><mo>(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>)</mo><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>g</mi><mi>e</mi></msub></mrow></mfrac><mo>⋅</mo><mo>(</mo><msub><mi>g</mi><mi>e</mi></msub><mo>−</mo><msub><mi>g</mi><mn>0</mn></msub><msup><mo>)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>≈</mo><mn>3</mn><mi>N</mi><mo>(</mo><mi>e</mi><mo>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>τ</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>e</mi><mo>∈</mo><mi>E</mi></mrow></munder><mn>2</mn><mo>(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo>(</mo><mi>e</mi><mo>)</mo><mo>)</mo><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>t</mi><mi>h</mi><msub><mi>r</mi><mi>e</mi></msub></mrow></mfrac><mo>⋅</mo><mo>(</mo><mi>t</mi><mi>h</mi><msub><mi>r</mi><mi>e</mi></msub><mo>−</mo><mi>t</mi><mi>h</mi><msub><mi>r</mi><mn>0</mn></msub><msup><mo>)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>≈</mo><mn>12</mn><mi>N</mi><mo>(</mo><mi>e</mi><mo>)</mo></mrow></mstyle></mtd></mtr></mtable><mspace width="1em"/><mo>(</mo><mn>13</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\begin{aligned}
\alpha &amp;= \sum_{e \in E} 2(1 - f(e)) \cdot \frac{\partial f}{\partial a_n} \cdot (a_n - a_0)^{-1} \approx 3N(n) \\
\gamma &amp;= \sum_{e \in E} 2(1 - f(e)) \cdot \frac{\partial f}{\partial g_e} \cdot (g_e - g_0)^{-1} \approx 3N(e) \\
\tau &amp;= \sum_{e \in E} 2(1 - f(e)) \cdot \frac{\partial f}{\partial thr_e} \cdot (thr_e - thr_0)^{-1} \approx 12N(e)
\end{aligned} \quad (13)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:8.979437999999998em;vertical-align:-4.239718999999999em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.739718999999999em;"><span style="top:-6.739718999999999em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span><span style="top:-3.746573em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-0.7534270000000007em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.239718999999999em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.739718999999999em;"><span style="top:-6.739718999999999em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">3</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span><span style="top:-3.746573em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">3</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-0.7534270000000007em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.239718999999999em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span></p>
<p>在总损失梯度为零的最优点处，各偏导数还满足以下关系：$$\frac{\partial f}{\partial thr_e} = -1$$, $$-1 &lt; \frac{\partial f}{\partial a_n} &lt; 0$$, $$-1 &lt; \frac{\partial f}{\partial g_e} &lt; 0$$ 。根据 §III-A，默认值通常为 $$a_0 = 0$$ 和 $$g_0 = 1$$。我们可以做出以下估算：$$f(e) \approx -0.5$$，$$\frac{\partial f}{\partial a_n} \approx 0.5$$, $$a_n - a_0 \approx 0.5$$，$$\frac{\partial f}{\partial g_e} \approx -0.5$$，$$g_e - g_0 \approx -0.5$$，$$thr_e - thr_0 \approx -0.25$$。令 $$N(n)$$ 和 $$N(e)$$ 分别为允许的与节点 $$n$$ 和事件 $$e$$ 相关的误报数量。</p>
<p>值得注意的是，上述数值仅为启发式估计。由于攻击者可能隐藏在训练数据中或利用良性实体，正则化系数的选择取决于“良性”数据集的假定纯度。因此，不存在一种通用的最优方法来选择这些系数。取而代之的是，我们提出了一种动态调整策略，该策略以估计值为起点，并根据模型性能进行自适应调整。如果与保守基线相比出现了漏报，则通过将系数乘以一个设定因子（例如 10）来使正则化更为严格。反之，若在较长一段时间内未出现漏报，则可通过除以相同的因子来放宽正则化，随后对模型进行重训练。</p>
<p><strong>在线学习触发器</strong>：每当观察到误分类时，在线学习机制便会被触发。在实验中，我们通过将系统输出与包含平均 70 个恶意事件的已标记基准（ground truth）数据集进行比对来模拟这一过程。在实际部署中，该触发信号将源自安全分析师的反馈，即分析师驳回误报或识别出漏报。</p>
<p><strong>4）数据标记</strong>：依据相应的攻击报告，我们将每个攻击场景杀伤链（kill chain）中的实体和事件标记为恶意，而将其他所有实体和事件标记为良性。尽管先前的研究 [11], [17] 在其开源代码库中提供了实体级标签，但它们往往缺乏明确的标记策略或充分的上下文细节。此外，我们观察到其数据集中的恶意标签数量高得不切实际。例如，在 Engagement 3 的 CADETS 数据集中，仅在 30 小时内就有超过 12,000 个系统实体被标记为恶意，这一数字无法反映真实的安全运营中心（SOC）环境。为确保 CAPTAIN+ 与基线系统之间的比较公平且无偏，我们在本次评估中创建并使用了我们自己的数据标签。这一标记过程并非易事，因为它需要将自然语言攻击报告中的描述映射到原始审计日志的记录中。为促进未来研究并提高可复现性，我们已将数据标签公开发布。</p>
<h2 id="b-how-accurate-is-captain-captain-的准确性如何"><strong>B. How accurate is CAPTAIN+? CAPTAIN+ 的准确性如何？</strong></h2>
<p><strong>1）误报事件的减少</strong>：我们首先在不同数据集上比较了 CAPTAIN+、CAPTAIN 和 MORSE 产生的误报数量。如表 VI 所示，与 CAPTAIN 相比，CAPTAIN+ 平均减少了超过 76% 的误报 。对于 S-2 和 S-3 数据集中尚未消除的剩余误报，CAPTAIN+ 未能将其移除的原因如下 。部分误报（特别是在数据集 S-2 和 S-3 中）的持续存在可归因于若干因素。首先，部分“虚假”警报涉及潜在的恶意节点（例如 S-2 中的特定配置文件），但由于无法直接映射至攻击步骤，因此未被标记为恶意 。其次，部分相关节点和边缺失于训练集中，或未能触发警报。此外，由于 CAPTAIN+ 采用了与 CAPTAIN 相同的初始训练方法，二者在检测阶段伊始的参数设置完全相同，这导致在在线学习被触发之前，部分初始误报不可避免。最后，为确保学习的稳定性，我们采用了逐渐增加学习率的策略，这意味着部分初始参数更新不会立即产生显著效果。为验证误报的减少并未以牺牲检测能力为代价，我们还分析了检测到的恶意事件数量 。表 VI 显示，CAPTAIN+ 检测到了 CAPTAIN 所能检测到的所有恶意事件，且在部分数据集（如 T-3, OpTC）中，其检测到的数量甚至更多。</p>
<p>TABLE VI: 事件级准确度比较</p>
<figure data-type="image" tabindex="13"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2Q2YzFiOTc0MjJmYjI2OTUxNmQyZGUyODQ2N2UxZDBfeEVWb2JlWEdpU2dNWGhMVkZCNXAwNXBkeloxQU5SbW1fVG9rZW46RWtuTWJ4czhUb1hBaFJ4Zk1MQ2NJdzlCbktmXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p><strong>2）误报实体的减少</strong>：尽管 CAPTAIN+ 是一种事件级检测器，我们仍将其与最先进的（SOTA）实体级 PIDS（如 FLASH、KAIROS 和 NODLINK）进行了比较。为使该比较具备可行性，我们将 MORSE、CAPTAIN 和 CAPTAIN+ 触发的警报事件转化为警报实体，即若某个实体涉及任何警报事件，则将其视为警报实体。为确保比较的完整性，我们还处理了数据集使用和评估指标方面的差异。尽管先前的工作 [11], [13], [17] 通常仅使用每个 DARPA 数据集的子集，但我们使用了完整的数据集以模拟更真实的 SOC 场景。为此，我们按照 §IV-A3 中的描述对数据进行了划分，并利用其提供的代码对基线模型进行了重训练。此外，我们观察到部分基线（如 FLASH 和 THREATRACE）采用了宽松的误报（FPs）统计标准 [13] 。为确保评估既公平又严格，我们报告的结果中包含“一跳误报（one-hop FP）”指标，即剔除了距离真实（ground-truth）攻击实体一跳范围内的任何误报实体 。实验设置上的这些差异解释了我们的结果与参考文献结果之间可能存在的出入。</p>
<p>我们在 CADETS、TRACE、THEIA 和 OpTC 数据集上评估了检测精度。如表 VII 所示，基线系统的性能差异显著。在基于嵌入的系统中，FLASH 报告了相当数量的真阳性（TPs）。然而，由于其基于 GNN 的方法在训练数据有限的情况下表现不佳，它产生了过多的误报（FPs）。KAIROS 在时间窗口检测方面表现良好，但在实体级精度方面表现较差。同样，NODLINK 检测到了大多数攻击，但也产生了许多误报，并遗漏了文件和网络套接字等关键实体。</p>
<p>TABLE VII: 节点级精度比较</p>
<figure data-type="image" tabindex="14"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=OWExODU2YjE0NmM5MWIyZjQ3MmU0OWQ0OGI1YTcyY2FfcDBlYmZ1NjlEVlNLQXRDdXRGSnVKWEVmQVNXNXliNUtfVG9rZW46R29oMmJIaFhpb1cwZnR4TW40WGN2YWpEblRlXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<blockquote>
<p>1 NODLINK仅提供检测到的过程，并对其准确性进行评估。</p>
</blockquote>
<p>基于规则的系统 MORSE 在节点级别实现了较低的误报率。这归因于其语义丰富的警报，为过滤提供了额外的上下文。例如，在文件损坏事件中，MORSE 会标记进程和受损文件，但文件节点可能会从最终警报中被过滤掉，因为它被视为攻击的目标而非恶意行为者本身。这解释了为什么 MORSE 会触发数千个事件级误报，但仅错误标记了数百个节点。此类语义过滤在基于嵌入的 PIDS 中是不可用的。</p>
<p>在所有数据集上，CAPTAIN+ 均展现出卓越的性能，识别出了大多数 TP，同时保持了较少的 FP，即使与 CAPTAIN 相比也是如此。由于 CAPTAIN+ 在事件级别运行，某些与攻击事件不直接关联的实体可能不会被报告。例如，当恶意软件被下载并执行时，CAPTAIN+ 会触发 MalFileCreation（恶意文件创建）和 FileExec（文件执行）警报，为分析师提供有关恶意软件进程、文件及父进程的关键信息 。然而，为防止警报疲劳，我们不会立即报告攻击者使用的入口网络节点。这种设计选择导致 CAPTAIN+ 中出现了一些漏报（FNs），其预期是分析师可以在初步响应后对这些相关节点进行调查。</p>
<h2 id="c-how-efficient-is-captain-captain-的效率如何"><strong>C. How efficient is CAPTAIN+? CAPTAIN+ 的效率如何？</strong></h2>
<p>在本节中，我们将 CAPTAIN+ 与最先进的（SOTA）PIDS（包括 FLASH、KAIROS、NODLINK、SHADEWATCHER、MORSE 和 CAPTAIN）进行比较，以评估其效率。</p>
<p><strong>1）检测延迟</strong>：在我们的评估中，我们将检测延迟定义为三个组成部分的总和：缓冲时间（源自 §II 中讨论的时间窗口机制造成的延迟）、预处理时间（例如，数据解析、特征提取）以及检测时间（从数据输入到结果输出）。由于训练可离线进行，我们的延迟评估主要关注测试阶段，并使用了 TRACE 和 CADETS 数据集。为确保比较的公平性，我们运行了基线系统的原始代码，排除了 I/O 时间以仅测量计算延迟，并验证了经预处理后输入至每个检测模块的数据量完全一致。</p>
<p>表 VIII 的结果显示，CAPTAIN+ 在预处理和检测时间方面均优于其他 PIDS。不同于那些依赖图结构嵌入且需要显著缓冲时间（从数分钟到数小时不等）的方法，CAPTAIN+ 以流式方式处理审计日志，从而完全消除了缓冲时间；同时，它采用轻量级的预处理流水线，实现了更快速的数据处理。</p>
<p>TABLE VIII: 检测延迟比较</p>
<figure data-type="image" tabindex="15"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=YWU0YjRmYjRmMjE5ZTY5MTFjZmQ3MWUxOTI2ODU1ZmNfWlpiajRneHIyZFRmOFFlTHB0Z0F5NnB5dzRJWWdxb0tfVG9rZW46UElmRGJPaENFb241bFZ4TTNOY2NzcUpubmxjXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<blockquote>
<p>1 我们在其代码或论文中未找到明确的数值。 </p>
<p>2 SHADEWATCHER 提取最后 10% 的交互作为测试集，而我们的测试集规模约为其 2.5 倍。</p>
</blockquote>
<p>此外，与 MORSE 和 CAPTAIN 等其他基于规则的系统相比，CAPTAIN+ 引入了在线学习机制，这意味着每一次误报或漏报都会触发参数调整。因此，CAPTAIN+ 在检测阶段的耗时会有所增加。然而，值得注意的是，CAPTAIN+ 的核心检测逻辑保持不变，因此这一额外耗时应被视为训练时间的一部分。平均而言，该额外耗时不足一分钟，我们认为相对于检测精度的提升，这一代价是微不足道的。</p>
<p>2) <strong>运行时开销</strong>：运行时开销是评估 PIDS 的另一项关键指标。本节评估 CAPTAIN+ 在检测阶段的运行时开销及内存占用情况。我们利用 Python 的 <code>resource</code> 模块来测量检测器的资源消耗，并在 CPU 模式下运行它们。这是考虑到在大多数现实世界的威胁检测场景中，GPU 可能并未配备。我们通过计算用户模式下的总 CPU 时间来评估 CPU 资源消耗，如图 3 (a) 所示。由于采用了深度学习库，KAIROS、FLASH 和 NODLINK 均为多线程运行，因此图 3 (a) 中的总 CPU 时间可能超过表 VIII 中报告的检测时间。相比之下，MORSE、CAPTAIN 和 CAPTAIN+ 均为单线程运行。为确保比较的公平性，在统计多核执行情况时，我们计算了所有核心的 CPU 时间总和。由于 CAPTAIN+ 依赖于基于实数标签的基础算术运算，其所需的 CPU 时间远少于基于嵌入的 PIDS（约为 FLASH 的 3% 和 KAIROS 的 0.3%），后者通常依赖于神经网络中复杂的矩阵与向量运算。此外，与检测延迟实验类似，相较于 CAPTAIN 和 MORSE，其 CPU 使用率可能会略有增加。</p>
<figure data-type="image" tabindex="16"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=NGE0Mjg5MDBiMTkzNzQ1MDNhOTc0NTdkNmNiMWM5OGVfTDFjOVEwRGFJWk5MSVJiZEgxakc0bEtwc3p5THU4NTlfVG9rZW46SVk5YWJxSlk1b2Vpckd4M09TN2NqZ1RVbkZnXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 3: 资源消耗比较</p>
<p>我们利用 Python 的 <code>psutil</code> 库来监控检测器在检测期间的内存使用情况。如图 3 (b) 所示，CAPTAIN+ 完成检测的速度远快于基于嵌入的 PIDS（如表 VIII 所示），且在整个检测过程中内存占用最低。 如图 3 (b) 所示，与 CAPTAIN 和 MORSE 相比，CAPTAIN+ 在内存使用和检测时间上均显示出轻微增加。这部分归因于针对每次误报所进行的调整，从而导致了多次调用。然而，这部分内存仅用于在线学习，并不影响实际检测。在实践中，用户可对误报进行批量处理和定期更新，从而进一步降低内存使用。若仅关注检测本身，与 CAPTAIN 进行比较能提供更清晰的视角。CAPTAIN+ 与 MORSE 之间微小的内存使用差异源于对细粒度规则的存储。总体而言，CAPTAIN+ 保留了基于规则的 PIDS 轻量级和快速的特性。</p>
<p>为进一步阐明 CAPTAIN+ 的运行时开销，我们在图 3 (c) 中展示了资源消耗比例。如图所示，开销主要源于在线学习模块（具体为梯度计算），约占额外成本的 30%。我们认为，与定期进行全模型重训练所需的显著更高成本相比，这是为实现实时模型适应所做出的合理权衡。</p>
<h2 id="d-how-robust-is-captain-against-adversarial-attacks-captain-对对抗性攻击的鲁棒性如何"><strong>D. How robust is CAPTAIN+ against adversarial attacks? CAPTAIN+ 对对抗性攻击的鲁棒性如何？</strong></h2>
<p>随着 PIDS 的发展，旨在规避这些检测机制的对抗性攻击正日益引起关注。本节考察了 CAPTAIN+ 对抗“模仿攻击”和“数据投毒攻击”的鲁棒性。</p>
<p><strong>1）对抗性模仿攻击</strong>：针对 PIDS 的模仿攻击通过篡改溯源数据并融入更多良性特征以“模仿良性行为”，从而逃避检测。我们采用文献 [11], [33] 中的攻击方法（即将良性结构插入攻击图）评估了 CAPTAIN+ 对抗模仿攻击的鲁棒性。我们的模仿攻击包含两个步骤：首先，从训练数据中提取常见的良性事件结构。然后，将这些良性结构中的原始实体替换为来自真实攻击图的恶意实体。这构建了一种伪装成日常系统活动的恶意行为。在实验中，鉴于 <em>CADETS</em> 数据集（Engagement 3）规模适中，我们选用该数据集，并重点测试了系统在特定事件 <code>(XIM, chmod, /tmp/test)</code> 被良性结构伪装后的响应情况。</p>
<p>如图 4 (a) 所示，CAPTAIN+ 和 FLASH 在对抗模仿攻击方面均展现出了一定的鲁棒性。即便在添加了良性活动后，攻击实体 (/tmp/test) 仍能被两个系统检测到。然而，我们观察到仅需添加少量良性事件（少于 10 个），FLASH 的异常评分便出现显著下降，这一结果也在文献 [11] 中得到了证实。另一方面，CAPTAIN+ 未受模仿攻击的影响，表现出优于基线的鲁棒性。</p>
<figure data-type="image" tabindex="17"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=YTMwOGMwYmY5Njk0NDMyMjM0N2ViNTc5Yzc1YmEyOGVfNkRhcm8yTmF1TFQ5SkRuSEZvc3NQazB1d3dKYzhqdW5fVG9rZW46S0w1VGJXYVdNb2pSU3J4SHFZZGNIVXNSbmZmXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 4: 对抗性攻击对 CAPTAIN+ 的影响</p>
<p>CAPTAIN+ 通过以下三个关键因素实现了鲁棒性：</p>
<p><strong>1）基于启发式的传播</strong>：不同于像 FLASH 这样基于嵌入的 PIDS，CAPTAIN+ 采用的启发式规则受微小良性变化的影响较小。</p>
<p><strong>2）事件级检测</strong>：与实体级检测器相比，CAPTAIN+ 在更细的粒度（事件级）上工作。由于在事件级运行且无缓冲，CAPTAIN+ 不受攻击后添加的良性事件的影响——这与基于时间窗口的检测器不同。</p>
<p><strong>3）保守的、基于规则的检测</strong>：CAPTAIN+ 并非基于异常检测；它利用在正常数据上训练的保守规则来减少误报。因此，添加正常特征不会削弱其检测能力，因为保守的规则确保了检测的可靠性。</p>
<p><strong>2）数据投毒攻击</strong>：数据投毒是指将恶意事件注入良性训练数据中，致使检测器习得攻击者精心设计的模式，从而可能导致漏检未来的攻击。为增强 CAPTAIN+ 的鲁棒性，我们在损失函数中引入了正则化项，以降低其对训练数据的敏感度，并减轻此类操纵行为的影响。</p>
<p><strong>训练集投毒攻击</strong>：本节通过利用 Engagement 3 TRACE 数据集中的真实攻击场景——即 Pine 后门与钓鱼邮件攻击，展示了 CAPTAIN+ 对抗训练集投毒攻击的弹性。在此攻击中，一个易受攻击的 <code>pine</code> 应用程序连接至邮件服务器 <code>128.55.12.73</code>，下载并执行了钓鱼邮件附件。然而，由于 <code>128.55.12.73</code> 存在多种活动，这在训练数据中引发了若干“虚假”警报。这违反了我们（如 §II-D 所述）关于训练集应不包含攻击实体或事件的假设，使其成为数据集投毒的理想测试用例。</p>
<p>为了分析此次攻击，我们重点关注 IP 节点 <code>128.55.12.73</code> 的初始完整性标签 ($$a$$)，这展示了正则化项的影响。若没有正则化器，由于 <code>128.55.12.73</code> 在训练数据中存在良性活动，它将获得较高的完整性评分（接近 1.0），这将导致我们漏检源自该 IP 的钓鱼邮件攻击。然而，当我们应用正则化器（$$\alpha = 10$$）时，CAPTAIN+ 在训练期间变得更为谨慎，为该 IP 分配了较低的完整性评分 0.488，这与 §II-E 中的“灰色节点”示例类似。这有助于防止误报，并确保钓鱼邮件攻击被正确检测。更多细节详见 §IV-G。此外，针对该攻击 <code>(pine, read, 128.55.12.73)</code> 的事件传播率变得更为保守，从而有助于减轻被投毒训练集的影响。</p>
<p><strong>在线学习投毒攻击</strong>：为评估 CAPTAIN+ 对抗在线学习投毒攻击的鲁棒性，我们模拟了攻击者试图通过注入具有误导性的良性事件来影响系统的场景。实验基于 Engagement 3 的 CADETS 数据集进行，重点关注恶意事件 <code>(XIM, chmod, /tmp/test)</code>。该攻击通过以下方式进行模拟：创建一个恶意文件 <code>/tmp/test</code> 以模仿良性文件（<code>/dev/tty</code>）的交互模式，并插入良性进程（如 <code>newsyslog</code>）的先行执行作为噪声。如图 4 (b) 所示，尽管这些虚假事件的注入导致误报逐渐增加，但 CAPTAIN+ 始终保持了对真阳性（True Positive）事件的检测能力。这种鲁棒性主要归因于受控的在线学习率，它防止了模型对误导性反馈产生过度反应，从而避免将恶意事件错误地重分类为良性。总体而言，CAPTAIN+ 证明了其对此类对抗性攻击具有高度的鲁棒性。</p>
<h2 id="e-how-is-the-long-term-performance-of-captain-captain-的长期性能如何">E. How is the long-term performance of CAPTAIN+? <strong>CAPTAIN+ 的长期性能如何？</strong></h2>
<p>在本节中，我们通过追踪误报随时间的变化，比较了 CAPTAIN+ 和 CAPTAIN 对概念漂移的适应性 。我们将检测到的事件数量作为时间的代理指标，并在来自 DARPA Engagement 3 的 CADETS、TRACE 和 THEIA 数据集上对这两个系统进行了评估。</p>
<p>如图 5 所示，无论是在最终结果还是随时间增长的速率方面，CAPTAIN+ 在控制误报上的表现均优于 CAPTAIN。尽管 CAPTAIN 在早期阶段能够较好地控制误报，但随着时间的推移，其误报率迅速上升。相比之下，CAPTAIN+ 在整个检测过程中维持了相对较低的误报率，尤其是在 TRACE 和 THEIA 数据集中。在 CADETS 数据集中，由于误报率本身较低，在线学习的效果不甚明显。CAPTAIN+ 性能的关键在于其在线学习机制。在每次发生错误检测后，系统会更新其参数和节点标签，从而使 CAPTAIN+ 能够有效地控制误报并适应新模式。</p>
<figure data-type="image" tabindex="18"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDQ2NzEzM2I5MzdhZTdkZWM4M2UwZmYxODg1OWE1MDVfNU1Vck1uQWFSdVI2R1Z1NkxSSlhHTmIwZkJxbnl5M1BfVG9rZW46R3l3WWJ3a1pJbzM1Y0h4SVNIZmN3UjBTbk1mXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 5: 长期假阳性的比较分析</p>
<p>在线学习不仅减少了误报，还解决了攻击漏报问题。例如，当事件 <code>(ztmp, write, 162.66.239.75)</code> 首次出现在 TRACE 数据集中时，CAPTAIN+ 和 CAPTAIN 均漏检了该事件。然而，当该事件再次发生时，得益于在线学习，CAPTAIN+ 正确地标记了该事件，而 CAPTAIN 则再次漏检。</p>
<h2 id="f-how-do-modules-influence-captains-performance-各模块如何影响-captain-的性能"><strong>F. How do modules influence CAPTAIN+’s performance? 各模块如何影响 CAPTAIN+ 的性能？</strong></h2>
<p><strong>1）学习率的消融实验</strong>：在训练期间，学习率不仅决定了学习速度，还控制着搜索的粒度。我们利用 CADETS 数据集评估了学习率的影响。如图 6 (a) 所示，较高的学习率会导致训练损失在初始轮次（epochs）中出现更急剧的下降。相比之下，较低的学习率能够实现更精细的优化，在训练轮次充足的情况下产生更低的最终损失。这就需要在训练速度与最终模型质量之间取得平衡。基于该图，若受限于资源约束，训练被限制在 20 个轮次内，则 0.01 的学习率更为可取。然而，对于更长的训练持续时间，0.001 的学习率能取得更优的结果。</p>
<figure data-type="image" tabindex="19"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=MTEwNmE3YTBlNmQ2OTU4ZDgzZWZhZjEwYjI0ZmNjNjVfWE51OUJ4M1hlR0dsVkNOeEdrY2xwZEk0WVZmVHdnWDdfVG9rZW46S3lIM2JVYnljb2szVzN4UGg5T2NSeVhSbm1jXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 6: 参数对检测性能的影响</p>
<p><strong>2）三个参数的消融实验</strong>：我们进行了消融实验，以评估每个自适应参数（$$A$$、$$G$$和$$T$$）的贡献。由于这些参数可以独立调整，我们进行了七组实验，每组实验优化不同的参数子集：$${A}, {G}, {T}, {A, G}, {A, T}, {G, T}$$和$${A, T, G}$$。如图 6 (b) 所示的结果揭示了若干关键发现。首先，仅调整警报阈值（$$T$$）对性能的影响有限。这是因为，若不对初始标签或传播率进行更改，传播后的标签值往往会向 0 或 1 两极分化，致使连续阈值失效。结果还表明，调节标签初始化参数（$$A$$）是降低误报最有效的单参数策略，其发挥的作用比$$G$$或$$T$$更为关键。</p>
<p>尽管结合所有三个参数（$$A$$、$$G$$ 和 $$T$$）通常能带来增量改进，但我们观察到，在特定数据集（S-3 和 C-3）上，仅调整 $$T$$ 有时会导致更少的误报。出现这种情况是因为，在缺乏调节传播率或阈值能力的情况下，优化过程通过向更广泛的节点集合分配更高的完整性标签来进行补偿 。虽然这能以粗粒度的方式减少误报，但它存在导致系统过于宽松的风险。最后，同时调整所有三个参数的一个显著优势在于加速了训练过程的收敛。如图 6 (b) 所示，尽管 $${A}$$、$${A, T}$$ 和 $${A, T, G}$$ 配置在测试集上取得了相当的最终检测性能，但完整的 $${A, T, G}$$ 模型在训练期间收敛所需的轮次显著减少。</p>
<p><strong>3）在线学习模块的消融实验</strong>：为了评估在线学习模块中各组件的贡献，我们针对三个关键子模块——“漏报反馈”、“节点标签更新”和“学习率调整”——进行了消融实验，结果呈现在表 IX 中。禁用漏报反馈环节虽然进一步减少了误报，但其代价是由于系统过度宽松而导致攻击漏检，这是不可接受的 。同样，移除学习率调整机制并使用固定学习率导致误报增加，这表明动态调整对于修正误报至关重要 。最后，移除节点标签更新子模块虽然也减少了误报，但显著限制了 CAPTAIN+ 对漏报的响应能力及修正能力 。综合来看，这些实验证明了每个子模块对于在实现高检测精度与低误报率之间取得理想平衡都至关重要 。</p>
<p>TABLE IX: 网络学习模块的消融研究</p>
<figure data-type="image" tabindex="20"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDA0ZTFlYzI5YzcyZjA4YTUwMTllNzM2ZDA2NWYxNWJfWmh3QThibWJMbjh4YlhkWEw0aFk4VFVlVjNCNGtWN21fVG9rZW46TlEyNmJ4RUdNb1l0ZDF4dW41b2N6cFBibnJkXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<h2 id="g-case-study-案例研究"><strong>G. Case Study 案例研究</strong></h2>
<p>基于规则的 PIDS 相较于基于嵌入的 PIDS 的另一优势在于检测过程的可解释性。为考察 CAPTAIN+ 的可解释性，我们将 E3-TRACE 数据集的训练结果作为案例研究进行深入分析。该案例研究突显了 CAPTAIN+ 的核心优势——得益于自适应参数的细粒度检测能力。如 §II-E 和 §III 所述，与先前使用离散的、人工分配的数值和全局规则的工作 [18]–[20] 不同，CAPTAIN+ 为每个实体和事件微调定制化的数值参数，从而提升了其区分良性与恶意行为细微差异的能力。</p>
<p>图 7 (a) 展示了 CAPTAIN+ 如何利用微调后的参数更好地通过区分相似行为。在这两种情况下，进程 <code>pine</code> 均从 <code>128.55.12.73</code>（可能是邮件服务器）读取数据，并创建、写入以及更改一个新文件的权限。传统的基于规则的 PIDS（如 MORSE [18], [19]）难以对 <code>128.55.12.73</code> 分配标签：若将该 IP 标记为良性（标签 = 1.0），则会漏检攻击的第一阶段；而若将初始标签设为“不受信任”，则会在左侧的良性图中引发多个虚假的“恶意文件创建”和“更改权限”警报。相反，CAPTAIN+ 为该 IP 分配了一个适中的初始标签 $$a_n$$（0.488），并将事件 <code>(pine, create, /home/admin/pinerc174500)</code> 的阈值 $$thr$$ 从 0.5 略微调低至 0.478。由于 $$0.478 &lt; 0.488$$，该文件的创建不会触发警报；但在真实攻击中，事件 <code>(pine, create, /tmp/tcexec)</code> 的阈值 $$thr$$ 仍为 0.5，这意味着创建恶意文件仍会触发警报（$$0.5 &gt; 0.488$$）。</p>
<figure data-type="image" tabindex="21"><img src="https://ai.feishu.cn/space/api/box/stream/download/asynccode/?code=M2RlMDRlMTQ4MTViMjM1NjQ4MmJkYTBmNGRjOTczYjlfUzY1c3BiNVJSNU1mMnFwYlpkNDJLRktSb09Ha2ZkMGxfVG9rZW46TENUQWJkRklzb2hjRFl4TXV2aWM1ZkxyblFiXzE3NjQ1NzkzMzk6MTc2NDU4MjkzOV9WNA" alt="" loading="lazy"></figure>
<p>Fig. 7:<strong> </strong>选自 Engagement 3 TRACE 的案例研究。为保持图表清晰简洁，我们省略了部分无关细节。</p>
<p>与 MORSE 固定的衰减因子不同，CAPTAIN+ 通过细粒度的传播率，通过为不同事件学习不同的值，更精确地解决了由 <code>libresolv.so.2</code> 引起的依赖爆炸问题。如图 7 (b) 所示，CAPTAIN+ 学会了为频繁导致依赖爆炸的事件（例如 <code>sshd</code> 或 <code>firefox</code> 读取文件时）分配较低的传播率，而即便对于同一个进程 <code>firefox</code>，CAPTAIN+ 也学会了在读取该文件时抑制依赖传播（$$g_e = 0.63$$），而在加载该文件时对恶意性传播保持敏感（$$g_e = 0.99$$）。这种自适应平衡防止了过度宽松，同时确保不遗漏任何恶意活动。</p>
<p>凭借其增强的区分能力，CAPTAIN+ 能够在确保检测到所有真实攻击的同时，相比传统的基于规则的 PIDS 显著减少误报 。CAPTAIN+ 的这些细粒度参数在检测模仿攻击方面优于许多基于嵌入的 PIDS 。例如，在图 7 (a) 中，攻击者可以修改 <code>/tmp/tcexec</code> 的文件名以进行模仿攻击，因为他们知道 <code>pine</code> 可能会与类似 <code>/home/admin/pinerc+numbers</code> 的文件进行交互。由于基于嵌入的 PIDS 广泛使用 Word2Vec 和 Sentence2Vec 等泛化技术，攻击者可以通过在 <code>pinerc</code> 后附加随机数字来篡改文件名，使其在嵌入后与 <code>pinerc174500</code> 相似。然而，攻击者需要 <code>pinerc174500</code> 的确切文件名才能规避 CAPTAIN+ 的检测，这使得模仿攻击变得更加复杂，尤其是在训练数据有限（7 天内仅有 4 个相关事件）的情况下 。</p>
<h1 id="v-讨论和结论">V 讨论和结论</h1>
<h2 id="a-more-optimization-algorithms-更多的优化算法">A. More Optimization Algorithms 更多的优化算法</h2>
<p>对于参数优化，我们采用了批量梯度下降（BGD）。选择 BGD 而非小批量或随机方法是经过审慎考虑的。在本文的语境下，一个“批次”涵盖了单个分析窗口内的所有事件。若像使用较小批次那样，在处理完整个图之前就更新自适应参数，可能会在传播过程中引入标签的不一致性。因此，为维持分析的完整性，全批量更新是必要的。然而，我们的可微分标签传播框架并不局限于 BGD。其提供一阶梯度的能力使其能够直接兼容众多其他优化器，如 Momentum、NAG [50]、ADADELTA [51]、ADAM [37] 以及 RMSPROP，这些优化器通常能实现更快且更稳定的收敛。因此，我们将这些替代优化策略的实现留待未来研究 。</p>
<h2 id="b-conclusion-结论">B. Conclusion 结论</h2>
<p>本文提出了 CAPTAIN+，这是一种基于标签的溯源入侵检测系统（PIDS），能够自动适应多样化的环境 。其适应性源于三个可调参数：标签初始化（$$A$$）、传播率（$$G$$）以及检测阈值（$$T$$）。我们提出了一种可微分的标签传播框架，使得可以通过梯度下降算法对这些参数进行优化。据我们所知，CAPTAIN+ 是首个利用基于梯度的方法实现自动化参数微调的 PIDS，克服了传统基于规则系统的僵化性 。在检测阶段，CAPTAIN+ 采用在线学习持续且实时地优化其配置。通过从误报和漏报中进行学习，它确保了持续的准确性——这是一种静态训练的离线模型所缺乏的能力。</p>
<h1 id="references">REFERENCES</h1>
<p>[1] A. Alshamrani, S. Myneni, A. Chowdhary, and D. Huang, “A survey on advanced persistent threats: Techniques, solutions, challenges, and research opportunities,” IEEE Communications Surveys Tutorials, vol. 21, no. 2, 2019. </p>
<p>[2] H. B. Review, “Missed alarms and 40 million stolen credit card numbers: How target blew it,” https://hbr.org/2014/03/ could-target-have-prevented-its-security-breach. [Online]. Available: https://hbr.org/2014/03/could-target-have-prevented-its-security-breach </p>
<p>[3] N. Y. Times, “Equifax says cyberattack may have affected 143 million the u.s.” https://www.nytimes.com/2017/09/07/business/ equifax-cyberattack.html. [Online]. Available: https://www.nytimes. com/2017/09/07/business/equifax-cyberattack.html </p>
<p>[4] G. P. Spathoulas and S. K. Katsikas, “Using a fuzzy inference system to reduce false positives in intrusion detection,” in 2009 16th International Conference on Systems, Signals and Image Processing, 2009, pp. 1–4. </p>
<p>[5] V. Chandola, A. Banerjee, and V. Kumar, “Anomaly detection: A survey,” ACM Comput. Surv., vol. 41, no. 3, jul 2009. [Online]. Available: https://doi.org/10.1145/1541880.1541882 </p>
<p>[6] C. Dietrich, K. Krombholz, K. Borgolte, and T. Fiebig, “Investigating system operators’ perspective on security misconfigurations,” in Proceedings of the 2018 ACM SIGSAC Conference on Computer and Communications Security, ser. CCS ’18. New York, NY, USA: Association for Computing Machinery, 2018, p. 1272–1289. [Online]. Available: https://doi.org/10.1145/3243734.3243794 </p>
<p>[7] S. C. Sundaramurthy, A. G. Bardas, J. Case, X. Ou, M. Wesch, J. McHugh, S. R. Rajagopalan, and L. F. Cranor, “A human capital model for mitigating security analyst burnout,” in Eleventh Symposium On Usable Privacy and Security (SOUPS 2015), 2015, pp. 347–359. </p>
<p>[8] B. A. Alahmadi, L. Axon, and I. Martinovic, “99% false positives: A qualitative study of SOC analysts’ perspectives on security alarms,” in 31st USENIX Security Symposium (USENIX Security 22), 2022.  </p>
<p>[9] S. C. Committee, “A “kill chain” analysis of the 2013 target data breach,” 2014. [Online]. Available: https://www.commerce.senate.gov/ services/files/24d3c229-4f2f-405d-b8db-a3a67f183883 </p>
<p>[10] F. Dong, S. Li, P. Jiang, D. Li, H. Wang, L. Huang, X. Xiao, J. Chen, X. Luo, Y. Guo et al., “Are we there yet? an industrial viewpoint on provenance-based endpoint detection and response tools,” in Proceedings of the 2023 ACM SIGSAC Conference on Computer and Communications Security, 2023, pp. 2396–2410. </p>
<p>[11] M. U. Rehman, H. Ahmadi, and W. U. Hassan, “Flash: A comprehensive approach to intrusion detection via provenance graph representation learning,” in 2024 IEEE Symposium on Security and Privacy (SP). IEEE Computer Society, 2024, pp. 139–139. </p>
<p>[12] F. Yang, J. Xu, C. Xiong, Z. Li, and K. Zhang, “Prographer: An anomaly detection system based on provenance graph embedding,” in 32nd USENIX Security Symposium, 2023.  </p>
<p>[13] Z. Cheng, Q. Lv, J. Liang, Y. Wang, D. Sun, T. Pasquier, and X. Han, “Kairos: Practical intrusion detection and investigation using wholesystem provenance,” arXiv preprint arXiv:2308.05034, 2023.  </p>
<p>[14] A. Goyal, G. Wang, and A. Bates, “R-caid: Embedding root cause analysis within provenance-based intrusion detection,” in 2024 IEEE Symposium on Security and Privacy (SP). IEEE Computer Society, 2024, pp. 257–257. </p>
<p>[15] J. Zengy, X. Wang, J. Liu, Y. Chen, Z. Liang, T.-S. Chua, and Z. L. Chua, “Shadewatcher: Recommendation-guided cyber threat analysis using system audit records,” in 2022 IEEE Symposium on Security and Privacy (SP). IEEE, 2022, pp. 489–506. </p>
<p>[16] S. Li, F. Dong, X. Xiao, H. Wang, F. Shao, J. Chen, Y. Guo, X. Chen, and D. Li, “Nodlink: An online system for fine-grained apt attack detection and investigation,” arXiv preprint arXiv:2311.02331, 2023.  </p>
<p>[17] S. Wang, Z. Wang, T. Zhou, H. Sun, X. Yin, D. Han, H. Zhang, X. Shi, and J. Yang, “Threatrace: Detecting and tracing host-based threats in node level through provenance graph learning,” IEEE Transactions on Information Forensics and Security, vol. 17, pp. 3972–3987, 2022. </p>
<p>[18] M. N. Hossain, S. M. Milajerdi, J. Wang, B. Eshete, R. Gjomemo, R. Sekar, S. Stoller, and V. Venkatakrishnan, “Sleuth: Real-time attack scenario reconstruction from cots audit data,” in 26th USENIX Security Symposium, 2017.  </p>
<p>[19] M. N. Hossain, S. Sheikhi, and R. Sekar, “Combating dependence explosion in forensic analysis using alternative tag propagation semantics,” in IEEE Symposium on Security and Privacy (SP), 2020.  </p>
<p>[20] S. M. Milajerdi, R. Gjomemo, B. Eshete, R. Sekar, and V. Venkatakrishnan, “Holmes: Real-time apt detection through correlation of suspicious information flows,” in IEEE Symposium on Security and Privacy (SP), 2019. </p>
<p>[21] C. Xiong, T. Zhu, W. Dong, L. Ruan, R. Yang, Y. Cheng, Y. Chen, S. Cheng, and X. Chen, “Conan: A practical real-time apt detection system with high accuracy and efficiency,” IEEE Transactions on Dependable and Secure Computing, vol. 19, no. 1, pp. 551–565, 2022. </p>
<p>[22] W. U. Hassan, S. Guo, D. Li, Z. Chen, K. Jee, Z. Li, and A. Bates, “Nodoze: Combatting threat alert fatigue with automated provenance triage,” in 26th Annual Network and Distributed System Security Symposium, 2019.  </p>
<p>[23] X. Han, T. F. J. Pasquier, A. Bates, J. Mickens, and M. I. Seltzer, “Unicorn: Runtime provenance-based detector for advanced persistent threats,” in 27th Annual Network and Distributed System Security Symposium, 2020.  </p>
<p>[24] W. Lingzhi, S. Xiangmin, L. Weijian, L. Zhenyuan, R. Sekar, L. Han, and Y. Chen, “Incorporating gradients to rules: Towards lightweight, adaptive provenance-based intrusion detection.” in NDSS, 2025. </p>
<p>[25] “APT Notes,” 2019. [Online]. Available: https://github.com/kbandla/ APTnotes  </p>
<p>[26] “TC,” 2023, https://github.com/darpa-i2o/Transparent-Computing. </p>
<p>[27] “OpTC,” 2024, https://github.com/FiveDirections/OpTC-data. </p>
<p>[28] “ASAL,” 2023, https://github.com/PKU-ASAL/Simulated-Data. </p>
<p>[29] M. Zipperle, F. Gottwalt, E. Chang, and T. Dillon, “Provenance-based intrusion detection systems: A survey,” ACM Comput. Surv., 2022. </p>
<p>[30] Z. Li, Q. A. Chen, R. Yang, Y. Chen, and W. Ruan, “Threat detection and investigation with system-level provenance graphs: a survey,” Computers &amp; Security, vol. 106, p. 102282, 2021. </p>
<p>[31] Q. Wang, W. Hassan, D. Li, K. Jee, X. Yu, K. Zou, J. Rhee, Z. Chen, W. Cheng, C. Gunter, and H. Chen, “You are what you do: Hunting stealthy malware via data provenance analysis,” 01 2020. </p>
<p>[32] S. M. Milajerdi, B. Eshete, R. Gjomemo, and V. Venkatakrishnan, “Poirot: Aligning attack behavior with kernel audit records for cyber threat hunting,” ACM SIGSAC Conference on Computer and Communications Security, 2019.  </p>
<p>[33] A. Goyal, X. Han, G. Wang, and A. Bates, “Sometimes, you aren’t what you do: Mimicry attacks against provenance graph host intrusion detection systems,” in 30th Network and Distributed System Security Symposium (NDSS 23), 2023.  </p>
<p>[34] S. Ruder, “An overview of gradient descent optimization algorithms,” arXiv preprint arXiv:1609.04747, 2016.  </p>
<p>[35] H. Robbins and S. Monro, “A stochastic approximation method,” The annals of mathematical statistics, pp. 400–407, 1951.  </p>
<p>[36] J. Duchi, E. Hazan, and Y. Singer, “Adaptive subgradient methods for online learning and stochastic optimization.” Journal of machine learning research, vol. 12, no. 7, 2011. </p>
<p>[37] D. P. Kingma and J. Ba, “Adam: A method for stochastic optimization,” arXiv preprint arXiv:1412.6980, 2014.  </p>
<p>[38] J. R. Martins and A. Ning, Engineering design optimization. Cambridge University Press, 2021. </p>
<p>[39] X. Zhang, R. Zhao, Z. Jiang, Z. Sun, Y. Ding, E. C. Ngai, and S.-H. Yang, “Aoc-ids: Autonomous online framework with contrastive learning for intrusion detection,” in IEEE INFOCOM 2024 - IEEE Conference on Computer Communications, 2024, pp. 581–590.  </p>
<p>[40] Y. Wei, C. Cheng, and G. Xie, “Ofids : Online learning-enabled and fingerprint-based intrusion detection system in controller area networks,” IEEE Transactions on Dependable and Secure Computing, vol. 20, no. 6, pp. 4607–4620, 2023. </p>
<p>[41] A. Aldribi, I. Traor ́e, B. Moa, and O. Nwamuo, “Hypervisorbased cloud intrusion detection through online multivariate statistical change tracking,” Computers &amp; Security, vol. 88, p. 101646, 2020. [Online]. Available: https://www.sciencedirect.com/science/article/pii/ S0167404819301907 </p>
<p>[42] S. Han, Q. Wu, H. Zhang, B. Qin, J. Hu, X. Shi, L. Liu, and X. Yin, “Log-based anomaly detection with robust feature extraction and online learning,” IEEE Transactions on Information Forensics and Security, vol. 16, pp. 2300–2311, 2021. </p>
<p>[43] S. Arzt, S. Rasthofer, C. Fritz, E. Bodden, A. Bartel, J. Klein, Y. Le Traon, D. Octeau, and P. McDaniel, “Flowdroid: Precise context, flow, field, object-sensitive and lifecycle-aware taint analysis for android apps,” ACM sigplan notices, vol. 49, no. 6, pp. 259–269, 2014. </p>
<p>[44] S. Ma, X. Zhang, and D. Xu, “Protracer: Towards practical provenance tracing by alternating between logging and tainting,” in 23rd Annual Network And Distributed System Security Symposium (NDSS 2016). Internet Soc, 2016. </p>
<p>[45] K. H. Lee, X. Zhang, and D. Xu, “High accuracy attack provenance via binary-based execution partition.” in NDSS, vol. 16, 2013. </p>
<p>[46] J. Park, D. Nguyen, and R. Sandhu, “A provenance-based access control model,” in 2012 tenth annual international conference on privacy, security and trust. IEEE, 2012, pp. 137–144. </p>
<p>[47] S. S. Khan and M. G. Madden, “One-class classification: taxonomy of study and review of techniques,” The Knowledge Engineering Review, vol. 29, no. 3, pp. 345–374, 2014. </p>
<p>[48] D. M. Tax and R. P. Duin, “Data domain description using support vectors.” in ESANN, vol. 99, 1999, pp. 251–256. </p>
<p>[49] D. M. Tax and R. P. Duin, “Support vector domain description,” Pattern recognition letters, vol. 20, no. 11-13, pp. 1191–1199, 1999. </p>
<p>[50] Y. Nesterov, “A method for unconstrained convex minimization problem with the rate of convergence o (1/k2),” in Dokl. Akad. Nauk. SSSR, vol. 269, no. 3, 1983, p. 543. </p>
<p>[51] M. D. Zeiler, “Adadelta: an adaptive learning rate method,” arXiv preprint arXiv:1212.5701, 2012.</p>

            </div>
            
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
